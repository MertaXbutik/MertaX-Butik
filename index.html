<!doctype html>
<html lang="mk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MertaX Butik</title>
  <style>
    :root { --bg:#0b0b0b; --card:#121212; --muted:#bdbdbd; --txt:#fff; --accent:#22c55e; --danger:#ef4444; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:Arial, sans-serif; background:#f4f4f4; color:#111; }
    header{ background:#000; color:#fff; padding:18px 14px; text-align:center; font-size:26px; letter-spacing:2px; }
    nav{ background:#111; padding:10px; text-align:center; position:sticky; top:0; z-index:10; }
    nav a{ color:#fff; text-decoration:none; margin:0 14px; font-weight:700; }
    nav a:hover{ text-decoration:underline; }
    .container{ max-width:1100px; margin:0 auto; padding:18px; }
    .hero{
      background:linear-gradient(135deg,#000,#333);
      color:#fff; border-radius:14px;
      padding:34px 18px; text-align:center;
      margin:18px 0;
    }
    .hero h1{ margin:0 0 10px; font-size:40px; }
    .hero p{ margin:0; color:#e5e5e5; font-size:18px; }

    .topbar{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin:14px 0;
    }
    .search{ flex:1; min-width:220px; }
    .search input{
      width:100%; padding:10px 12px; border-radius:10px;
      border:1px solid #ddd; outline:none;
    }
    .btn{
      border:0; border-radius:10px; padding:10px 12px;
      font-weight:800; cursor:pointer;
    }
    .btn.primary{ background:var(--accent); color:#052e12; }
    .btn.dark{ background:#111; color:#fff; }
    .btn.danger{ background:var(--danger); color:#fff; }
    .badge{ display:inline-block; padding:4px 8px; border-radius:999px; background:#e5e7eb; font-weight:700; font-size:12px; }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:14px;
    }
    .card{
      background:#fff; border-radius:14px; overflow:hidden;
      border:1px solid #eee;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      display:flex; flex-direction:column;
    }
    .card img{ width:100%; height:220px; object-fit:cover; background:#fafafa; }
    .card .p{ padding:12px; display:flex; flex-direction:column; gap:10px; }
    .title{ font-size:18px; font-weight:900; margin:0; }
    .price{ font-weight:900; font-size:16px; }
    .muted{ color:#6b7280; font-size:13px; }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    select, input[type="number"]{
      padding:9px 10px; border-radius:10px; border:1px solid #ddd; outline:none;
      min-width:120px;
    }
    .stocklist{ font-size:13px; color:#374151; }
    .stocklist span{ display:inline-block; margin-right:10px; }

    /* Cart drawer */
    .drawer{
      position:fixed; top:0; right:-420px; width:420px; max-width:92vw; height:100vh;
      background:#fff; border-left:1px solid #eee; box-shadow:-18px 0 40px rgba(0,0,0,.15);
      z-index:50; transition:.25s ease; display:flex; flex-direction:column;
    }
    .drawer.open{ right:0; }
    .drawer .hd{
      padding:14px; border-bottom:1px solid #eee; display:flex; align-items:center; justify-content:space-between;
    }
    .drawer .hd h3{ margin:0; }
    .drawer .body{ padding:12px 14px; overflow:auto; flex:1; }
    .line{ border-top:1px solid #eee; margin:10px 0; }
    .cart-item{
      display:flex; gap:10px; align-items:flex-start; padding:10px 0; border-bottom:1px solid #f1f1f1;
    }
    .cart-item img{ width:64px; height:64px; border-radius:10px; object-fit:cover; }
    .cart-item .meta{ flex:1; }
    .cart-item .meta b{ display:block; }
    .cart-item .meta small{ color:#6b7280; }
    .cart-item .actions{ display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
    .qty{ display:flex; gap:6px; align-items:center; }
    .qty button{ width:30px; height:30px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; font-weight:900; }
    .drawer .ft{
      padding:14px; border-top:1px solid #eee; background:#fafafa;
    }
    .total{ font-weight:900; font-size:18px; display:flex; justify-content:space-between; }

    /* Checkout modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:80;
      display:none; align-items:center; justify-content:center; padding:16px;
    }
    .modal.open{ display:flex; }
    .modal .box{
      background:#fff; width:720px; max-width:96vw; border-radius:14px; overflow:hidden;
      box-shadow:0 30px 80px rgba(0,0,0,.25);
    }
    .modal .box .hd{ padding:14px; background:#111; color:#fff; display:flex; justify-content:space-between; align-items:center; }
    .modal .box .bd{ padding:14px; }
    .form{
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .form .full{ grid-column:1 / -1; }
    .form label{ font-size:12px; color:#374151; font-weight:800; display:block; margin:0 0 6px; }
    .form input, .form textarea, .form select{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #ddd; outline:none;
    }
    textarea{ min-height:90px; resize:vertical; }

    /* Admin */
    .admin{
      display:none;
      background:#0b0b0b; color:#fff; border-radius:14px; padding:14px; margin:18px 0;
    }
    .admin.open{ display:block; }
    .admin h3{ margin:0 0 10px; }
    .admin .panel{
      display:grid; grid-template-columns:1fr 1fr; gap:14px;
    }
    .admin .cardA{
      background:#121212; border:1px solid #222; border-radius:14px; padding:12px;
    }
    .admin table{ width:100%; border-collapse:collapse; font-size:13px; }
    .admin th,.admin td{ border-bottom:1px solid #222; padding:8px; text-align:left; vertical-align:top; }
    .admin input{ background:#0b0b0b; border:1px solid #333; color:#fff; }
    .admin .mut{ color:#bdbdbd; font-size:12px; }

    footer{ text-align:center; padding:18px; color:#fff; background:#111; margin-top:18px; }
  </style>
</head>
<body>
<header>MertaX Butik</header>

<nav>
  <a href="#pocetna">–ü–æ—á–µ—Ç–Ω–∞</a>
  <a href="#proizvodi">–ü—Ä–æ–∏–∑–≤–æ–¥–∏</a>
  <a href="#kontakt">–ö–æ–Ω—Ç–∞–∫—Ç</a>
  <a href="#admin" id="adminLink" style="opacity:.85;">Admin</a>
</nav>

<div class="container" id="pocetna">
  <div class="hero">
    <h1>–î–æ–±—Ä–µ–¥–æ—ò–¥–æ–≤—Ç–µ –≤–æ MertaX</h1>
    <p>–ú–æ–¥–µ—Ä–µ–Ω —Å—Ç–∏–ª. –í—Ä–≤–µ–Ω –∫–≤–∞–ª–∏—Ç–µ—Ç.</p>
  </div>

  <div class="topbar" id="proizvodi">
    <div class="search">
      <input id="q" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò –ø—Ä–æ–∏–∑–≤–æ–¥..." />
    </div>
    <button class="btn dark" id="openCart">üõí –ö–æ—à–Ω–∏—á–∫–∞ <span class="badge" id="cartCount">0</span></button>
    <button class="btn primary" id="openCheckout">‚úÖ –ù–∞—Ä–∞—á–∫–∞</button>
  </div>

  <div class="grid" id="grid"></div>

  <!-- Admin panel -->
  <div class="admin" id="adminPanel">
    <h3>Admin –ø–∞–Ω–µ–ª</h3>
    <div class="mut">–ù–∞–ø–æ–º–µ–Ω–∞: –æ–≤–∞ –µ ‚Äú–ª–µ—Å–µ–Ω‚Äù admin –∑–∞ GitHub Pages (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä). –ù–µ –µ 100% –±–µ–∑–±–µ–¥–Ω–æ.</div>
    <div class="line"></div>

    <div class="admin-controls" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <input id="adminPass" placeholder="Admin –∫–æ–¥" />
      <button class="btn primary" id="adminLogin">–í–ª–µ–∑–∏</button>
      <button class="btn dark" id="adminLogout">–ò–∑–ª–µ–∑–∏</button>
      <button class="btn danger" id="resetAll">–†–µ—Å–µ—Ç (–∑–∞–ª–∏—Ö–∞+–∫–æ—à–Ω–∏—á–∫–∞+–Ω–∞—Ä–∞—á–∫–∏)</button>
    </div>

    <div class="line"></div>

    <div class="panel">
      <div class="cardA">
        <b>–ó–∞–ª–∏—Ö–∞ –ø–æ –≤–µ–ª–∏—á–∏–Ω–∏</b>
        <div class="mut">–°–º–µ–Ω–∏ –±—Ä–æ—ò –∏ –∫–ª–∏–∫–Ω–∏ ‚Äú–ó–∞—á—É–≤–∞—ò‚Äù.</div>
        <div class="line"></div>
        <div id="stockEditor"></div>
      </div>

      <div class="cardA">
        <b>–ù–∞—Ä–∞—á–∫–∏ (–ª–æ–∫–∞–ª–Ω–æ)</b>
        <div class="mut">–°–µ —á—É–≤–∞–∞—Ç –≤–æ –ø—Ä–µ–ª–∏—Å—Ç—É–≤–∞—á–æ—Ç (localStorage).</div>
        <div class="line"></div>
        <div id="ordersBox"></div>
      </div>
    </div>
  </div>

</div>

<!-- Cart drawer -->
<div class="drawer" id="drawer">
  <div class="hd">
    <h3>–ö–æ—à–Ω–∏—á–∫–∞</h3>
    <button class="btn dark" id="closeCart">‚úñ</button>
  </div>
  <div class="body" id="cartBody"></div>
  <div class="ft">
    <div class="total"><span>–í–∫—É–ø–Ω–æ:</span><span id="cartTotal">0 –¥–µ–Ω.</span></div>
    <div style="display:flex; gap:10px; margin-top:10px;">
      <button class="btn dark" id="clearCart" style="flex:1;">–ò—Å–ø—Ä–∞–∑–Ω–∏</button>
      <button class="btn primary" id="checkoutFromCart" style="flex:1;">–ù–∞—Ä–∞—á–∞—ò</button>
    </div>
  </div>
</div>

<!-- Checkout modal -->
<div class="modal" id="checkoutModal">
  <div class="box">
    <div class="hd">
      <b>–ù–∞—Ä–∞—á–∫–∞</b>
      <button class="btn dark" id="closeCheckout">‚úñ</button>
    </div>
    <div class="bd">
      <div class="muted">–ù–∞—Ä–∞—á–∫–∞—Ç–∞ –º–æ–∂–µ—à –¥–∞ —ò–∞ –ø—Ä–∞—Ç–∏—à –ø—Ä–µ–∫—É WhatsApp –∏–ª–∏ Email (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä).</div>
      <div class="line"></div>

      <div class="form">
        <div>
          <label>–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ</label>
          <input id="cName" placeholder="–ü—Ä–∏–º–µ—Ä: –ê–ª–µ–∫" />
        </div>
        <div>
          <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input id="cPhone" placeholder="+389..." />
        </div>
        <div class="full">
          <label>–ê–¥—Ä–µ—Å–∞</label>
          <input id="cAddr" placeholder="–£–ª–∏—Ü–∞, –±—Ä–æ—ò, –≥—Ä–∞–¥" />
        </div>
        <div>
          <label>–ù–∞—á–∏–Ω –Ω–∞ –∏—Å–ø–æ—Ä–∞–∫–∞</label>
          <select id="cShip">
            <option value="–ö—É—Ä–∏—Ä">–ö—É—Ä–∏—Ä</option>
            <option value="–ü–æ–¥–∏–≥–Ω—É–≤–∞—ö–µ">–ü–æ–¥–∏–≥–Ω—É–≤–∞—ö–µ</option>
          </select>
        </div>
        <div>
          <label>–ü–ª–∞—ú–∞—ö–µ</label>
          <select id="cPay">
            <option value="–ü–æ –¥–æ—Å—Ç–∞–≤–∞">–ü–æ –¥–æ—Å—Ç–∞–≤–∞</option>
            <option value="–¢—Ä–∞–Ω—Å–∞–∫—Ü–∏—Å–∫–∞">–¢—Ä–∞–Ω—Å–∞–∫—Ü–∏—Å–∫–∞</option>
            <option value="–ü—Ä–∏ –ø–æ–¥–∏–≥–Ω—É–≤–∞—ö–µ">–ü—Ä–∏ –ø–æ–¥–∏–≥–Ω—É–≤–∞—ö–µ</option>
          </select>
        </div>
        <div class="full">
          <label>–ó–∞–±–µ–ª–µ—à–∫–∞</label>
          <textarea id="cNote" placeholder="–ë–æ—ò–∞, –≤—Ä–µ–º–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∞..."></textarea>
        </div>
      </div>

      <div class="line"></div>

      <div class="row">
        <button class="btn dark" id="sendEmail">üìß –ü—Ä–∞—Ç–∏ Email</button>
        <button class="btn primary" id="sendWhatsApp">üí¨ –ü—Ä–∞—Ç–∏ WhatsApp</button>
        <button class="btn dark" id="confirmOrder">‚úÖ –ü–æ—Ç–≤—Ä–¥–∏ (–Ω–∞–º–∞–ª–∏ –∑–∞–ª–∏—Ö–∞)</button>
      </div>

      <div class="muted" style="margin-top:10px;">
        * ‚Äû–ü–æ—Ç–≤—Ä–¥–∏‚Äú —ò–∞ —Å–Ω–∏–º–∞ –Ω–∞—Ä–∞—á–∫–∞—Ç–∞ –ª–æ–∫–∞–ª–Ω–æ –∏ —ò–∞ –Ω–∞–º–∞–ª—É–≤–∞ –∑–∞–ª–∏—Ö–∞—Ç–∞.
      </div>
    </div>
  </div>
</div>

<div class="container" id="kontakt">
  <h2>–ö–æ–Ω—Ç–∞–∫—Ç</h2>
  <p>üìû –¢–µ–ª–µ—Ñ–æ–Ω: <b>+389 XX XXX XXX</b> (–∑–∞–º–µ–Ω–∏)</p>
  <p>üìß Email: <b>mertax@example.com</b> (–∑–∞–º–µ–Ω–∏)</p>
  <p>üí¨ WhatsApp: <b>+389 XX XXX XXX</b> (–∑–∞–º–µ–Ω–∏)</p>
</div>

<footer>¬© 2026 MertaX Butik | –°–∏—Ç–µ –ø—Ä–∞–≤–∞ —Å–µ –∑–∞–¥—Ä–∂–∞–Ω–∏</footer>

<script>
/** =========================
 *  CONFIG (—Å–º–µ–Ω—É–≤–∞—à —Ç—É–∫–∞)
 *  ========================= */
const SHOP = {
  currency: "–¥–µ–Ω.",
  // —Å—Ç–∞–≤–∏ —Ç–≤–æ—ò WhatsApp –±—Ä–æ—ò —Å–æ –∫–æ–¥ –Ω–∞ –¥—Ä–∂–∞–≤–∞, –±–µ–∑ + –∏ –±–µ–∑ –ø—Ä–∞–∑–Ω–∏ –º–µ—Å—Ç–∞ (–ø—Ä–∏–º–µ—Ä 38970111222)
  whatsappNumber: "38970000000",
  // —Å—Ç–∞–≤–∏ —Ç–≤–æ—ò email
  emailTo: "mertax@example.com",
  // –ø—Ä–æ—Å—Ç admin –∫–æ–¥ (–ù–ï –µ 100% —Å–∏–≥—É—Ä–Ω–æ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä)
  adminCode: "1234"
};

// –ü–æ—á–µ—Ç–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ + –∑–∞–ª–∏—Ö–∞ –ø–æ –≤–µ–ª–∏—á–∏–Ω–∏
const DEFAULT_PRODUCTS = [
  {
    id: "majca",
    name: "–ú–∞—ò—Ü–∞ MertaX",
    price: 1200,
    img: "https://via.placeholder.com/600x400?text=Majca",
    sizes: { "S": 2, "M": 3, "L": 1, "XL": 0 }
  },
  {
    id: "dukser",
    name: "–î—É–∫—Å–µ—Ä MertaX",
    price: 2500,
    img: "https://via.placeholder.com/600x400?text=Dukser",
    sizes: { "S": 0, "M": 2, "L": 2, "XL": 1 }
  },
  {
    id: "jakna",
    name: "–à–∞–∫–Ω–∞ MertaX",
    price: 3900,
    img: "https://via.placeholder.com/600x400?text=Jakna",
    sizes: { "M": 1, "L": 1, "XL": 1 }
  }
];

/** =========================
 *  STORAGE
 *  ========================= */
const LS_PRODUCTS = "mertax_products_v1";
const LS_CART = "mertax_cart_v1";
const LS_ORDERS = "mertax_orders_v1";
const LS_ADMIN = "mertax_admin_ok_v1";

function loadProducts(){
  const raw = localStorage.getItem(LS_PRODUCTS);
  if(!raw){
    localStorage.setItem(LS_PRODUCTS, JSON.stringify(DEFAULT_PRODUCTS));
    return structuredClone(DEFAULT_PRODUCTS);
  }
  try{ return JSON.parse(raw); }catch(e){
    localStorage.setItem(LS_PRODUCTS, JSON.stringify(DEFAULT_PRODUCTS));
    return structuredClone(DEFAULT_PRODUCTS);
  }
}
function saveProducts(p){ localStorage.setItem(LS_PRODUCTS, JSON.stringify(p)); }

function loadCart(){
  const raw = localStorage.getItem(LS_CART);
  if(!raw) return [];
  try{ return JSON.parse(raw); }catch(e){ return []; }
}
function saveCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); }

function loadOrders(){
  const raw = localStorage.getItem(LS_ORDERS);
  if(!raw) return [];
  try{ return JSON.parse(raw); }catch(e){ return []; }
}
function saveOrders(o){ localStorage.setItem(LS_ORDERS, JSON.stringify(o)); }

let products = loadProducts();
let cart = loadCart();

/** =========================
 *  HELPERS
 *  ========================= */
const $ = (id)=>document.getElementById(id);
function money(n){ return `${n} ${SHOP.currency}`; }

function totalCart(){
  let t=0;
  for(const it of cart){
    const p = products.find(x=>x.id===it.pid);
    if(!p) continue;
    t += p.price * it.qty;
  }
  return t;
}
function countCart(){
  return cart.reduce((a,b)=>a+b.qty,0);
}
function stockOf(pid, size){
  const p = products.find(x=>x.id===pid);
  if(!p) return 0;
  return Number(p.sizes?.[size] ?? 0);
}
function setStock(pid, size, val){
  const p = products.find(x=>x.id===pid);
  if(!p) return;
  p.sizes[size] = Math.max(0, Number(val||0));
}
function sizeListText(p){
  const parts = Object.entries(p.sizes||{}).map(([s,q])=>`${s} ‚Äì ${q}`);
  return parts.map(x=>`<span>${x}</span>`).join("");
}

function cartKey(pid, size){ return `${pid}__${size}`; }

/** =========================
 *  RENDER PRODUCTS
 *  ========================= */
function renderProducts(){
  const q = ($("q").value||"").toLowerCase().trim();
  const grid = $("grid");
  grid.innerHTML = "";

  const list = products.filter(p => !q || p.name.toLowerCase().includes(q));
  for(const p of list){
    // sizes available
    const sizeEntries = Object.entries(p.sizes||{});
    const sizeOptions = sizeEntries.map(([s,q])=>{
      const disabled = q<=0 ? "disabled" : "";
      const label = q<=0 ? `${s} (0)` : `${s} (${q})`;
      return `<option value="${s}" ${disabled}>${label}</option>`;
    }).join("");

    const anyInStock = sizeEntries.some(([_,q])=>q>0);

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}" />
      <div class="p">
        <div class="row">
          <p class="title">${p.name}</p>
          <span class="price">${money(p.price)}</span>
        </div>
        <div class="stocklist">${sizeListText(p)}</div>
        <div class="row">
          <select id="sz_${p.id}" ${anyInStock ? "" : "disabled"}>
            ${sizeOptions}
          </select>
          <button class="btn primary" id="add_${p.id}" ${anyInStock ? "" : "disabled"}>
            –î–æ–¥–∞—ò
          </button>
        </div>
        <div class="muted">* –ü—Ä–∏–∫–∞–∂–∞–Ω–æ: ‚Äú–í–µ–ª–∏—á–∏–Ω–∞ ‚Äì –∫–æ–ª–∏—á–∏–Ω–∞‚Äù (–ø—Ä–µ–æ—Å—Ç–∞–Ω–∞—Ç–æ)</div>
      </div>
    `;
    grid.appendChild(card);

    const addBtn = card.querySelector(`#add_${p.id}`);
    addBtn.addEventListener("click", ()=>{
      const sz = card.querySelector(`#sz_${p.id}`).value;
      if(!sz) return alert("–ò–∑–±–µ—Ä–∏ –≤–µ–ª–∏—á–∏–Ω–∞.");
      const st = stockOf(p.id, sz);
      if(st<=0) return alert("–ù–µ–º–∞ –∑–∞–ª–∏—Ö–∞ –∑–∞ —Ç–∞–∞ –≤–µ–ª–∏—á–∏–Ω–∞.");

      // add to cart (max = stock)
      const k = cartKey(p.id, sz);
      const existing = cart.find(x=>x.k===k);
      if(existing){
        if(existing.qty + 1 > st) return alert("–ù–µ–º–∞ –¥–æ–≤–æ–ª–Ω–æ –∑–∞–ª–∏—Ö–∞.");
        existing.qty += 1;
      }else{
        cart.push({ k, pid:p.id, size:sz, qty:1 });
      }
      saveCart(cart);
      updateCartUI();
      alert("–î–æ–¥–∞–¥–µ–Ω–æ –≤–æ –∫–æ—à–Ω–∏—á–∫–∞ ‚úÖ");
    });
  }
}

/** =========================
 *  CART UI
 *  ========================= */
function updateCartUI(){
  $("cartCount").textContent = countCart();
  $("cartTotal").textContent = money(totalCart());

  const box = $("cartBody");
  if(cart.length===0){
    box.innerHTML = `<p class="muted">–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</p>`;
    return;
  }
  box.innerHTML = "";

  for(const it of cart){
    const p = products.find(x=>x.id===it.pid);
    if(!p) continue;

    const st = stockOf(it.pid, it.size);
    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <img src="${p.img}" alt="">
      <div class="meta">
        <b>${p.name}</b>
        <small>–í–µ–ª–∏—á–∏–Ω–∞: <b>${it.size}</b> ‚Ä¢ –¶–µ–Ω–∞: ${money(p.price)}</small><br/>
        <small>–ó–∞–ª–∏—Ö–∞: ${st}</small>
      </div>
      <div class="actions">
        <div class="qty">
          <button data-a="dec">-</button>
          <b>${it.qty}</b>
          <button data-a="inc">+</button>
        </div>
        <button class="btn danger" data-a="rm" style="padding:7px 10px; border-radius:10px;">–ò–∑–±—Ä–∏—à–∏</button>
      </div>
    `;
    box.appendChild(row);

    row.querySelector('[data-a="dec"]').addEventListener("click", ()=>{
      it.qty = Math.max(1, it.qty-1);
      saveCart(cart);
      updateCartUI();
    });
    row.querySelector('[data-a="inc"]').addEventListener("click", ()=>{
      if(it.qty + 1 > st) return alert("–ù–µ–º–∞ –¥–æ–≤–æ–ª–Ω–æ –∑–∞–ª–∏—Ö–∞.");
      it.qty += 1;
      saveCart(cart);
      updateCartUI();
    });
    row.querySelector('[data-a="rm"]').addEventListener("click", ()=>{
      cart = cart.filter(x=>x.k!==it.k);
      saveCart(cart);
      updateCartUI();
    });
  }
}

function openCart(open=true){
  $("drawer").classList.toggle("open", open);
}

/** =========================
 *  CHECKOUT
 *  ========================= */
function openCheckout(open=true){
  if(open && cart.length===0) return alert("–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.");
  $("checkoutModal").classList.toggle("open", open);
}

function orderSummaryText(customer){
  const lines = [];
  lines.push(`–ù–∞—Ä–∞—á–∫–∞ - MertaX Butik`);
  lines.push(`------------------------`);
  lines.push(`–ò–º–µ: ${customer.name}`);
  lines.push(`–¢–µ–ª–µ—Ñ–æ–Ω: ${customer.phone}`);
  lines.push(`–ê–¥—Ä–µ—Å–∞: ${customer.addr}`);
  lines.push(`–ò—Å–ø–æ—Ä–∞–∫–∞: ${customer.ship}`);
  lines.push(`–ü–ª–∞—ú–∞—ö–µ: ${customer.pay}`);
  if(customer.note) lines.push(`–ó–∞–±–µ–ª–µ—à–∫–∞: ${customer.note}`);
  lines.push(`------------------------`);
  lines.push(`–°—Ç–∞–≤–∫–∏:`);
  for(const it of cart){
    const p = products.find(x=>x.id===it.pid);
    if(!p) continue;
    lines.push(`- ${p.name} | ${it.size} | x${it.qty} | ${money(p.price*it.qty)}`);
  }
  lines.push(`------------------------`);
  lines.push(`–í–∫—É–ø–Ω–æ: ${money(totalCart())}`);
  return lines.join("\n");
}

function readCustomer(){
  const customer = {
    name: $("cName").value.trim(),
    phone: $("cPhone").value.trim(),
    addr: $("cAddr").value.trim(),
    ship: $("cShip").value,
    pay: $("cPay").value,
    note: $("cNote").value.trim()
  };
  if(!customer.name || !customer.phone || !customer.addr){
    alert("–ü–æ–ø–æ–ª–Ω–µ—Ç–µ: –∏–º–µ, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å–∞.");
    return null;
  }
  return customer;
}

function confirmAndDecrementStock(customer){
  // check stock again
  for(const it of cart){
    const st = stockOf(it.pid, it.size);
    if(it.qty > st){
      alert(`–ù–µ–º–∞ –¥–æ–≤–æ–ª–Ω–æ –∑–∞–ª–∏—Ö–∞ –∑–∞: ${it.pid} (${it.size}). –û—Å–≤–µ–∂–∏ –∫–æ—à–Ω–∏—á–∫–∞.`);
      return false;
    }
  }
  // decrement
  for(const it of cart){
    const st = stockOf(it.pid, it.size);
    setStock(it.pid, it.size, st - it.qty);
  }
  saveProducts(products);

  // store order locally
  const orders = loadOrders();
  orders.unshift({
    id: "ORD-" + Math.random().toString(16).slice(2,8).toUpperCase(),
    at: new Date().toISOString(),
    customer,
    items: structuredClone(cart),
    total: totalCart()
  });
  saveOrders(orders);

  // clear cart
  cart = [];
  saveCart(cart);

  // re-render
  renderProducts();
  updateCartUI();
  renderAdmin();
  return true;
}

/** =========================
 *  ADMIN
 *  ========================= */
function isAdmin(){ return localStorage.getItem(LS_ADMIN)==="1"; }

function renderAdmin(){
  const panel = $("adminPanel");
  const shouldOpen = location.hash === "#admin";
  panel.classList.toggle("open", shouldOpen);

  if(!shouldOpen) return;

  const ok = isAdmin();
  $("adminPass").style.display = ok ? "none" : "inline-block";
  $("adminLogin").style.display = ok ? "none" : "inline-block";
  $("adminLogout").style.display = ok ? "inline-block" : "none";

  // stock editor
  const stockBox = $("stockEditor");
  if(!ok){
    stockBox.innerHTML = `<div class="mut">–í–Ω–µ—Å–∏ admin –∫–æ–¥ –∑–∞ –¥–∞ –≥–ª–µ–¥–∞—à/–º–µ–Ω—É–≤–∞—à –∑–∞–ª–∏—Ö–∞.</div>`;
  }else{
    stockBox.innerHTML = products.map(p=>{
      const rows = Object.entries(p.sizes||{}).map(([s,q])=>{
        return `
          <div style="display:flex; gap:8px; align-items:center; margin:6px 0;">
            <span style="min-width:62px;"><b>${s}</b></span>
            <input type="number" min="0" value="${q}" id="stk_${p.id}_${s}" style="width:110px; padding:8px 10px; border-radius:10px;">
          </div>
        `;
      }).join("");
      return `
        <div style="border:1px solid #222; border-radius:14px; padding:10px; margin:10px 0;">
          <b>${p.name}</b> <span class="mut">(${money(p.price)})</span>
          <div style="margin-top:8px;">${rows}</div>
          <button class="btn primary" data-save="${p.id}" style="margin-top:8px;">–ó–∞—á—É–≤–∞—ò</button>
        </div>
      `;
    }).join("");

    stockBox.querySelectorAll("[data-save]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const pid = btn.getAttribute("data-save");
        const p = products.find(x=>x.id===pid);
        if(!p) return;
        for(const s of Object.keys(p.sizes||{})){
          const v = document.getElementById(`stk_${pid}_${s}`).value;
          setStock(pid, s, v);
        }
        saveProducts(products);
        renderProducts();
        alert("–ó–∞—á—É–≤–∞–Ω–æ ‚úÖ");
      });
    });
  }

  // orders
  const orders = loadOrders();
  const oBox = $("ordersBox");
  if(!ok){
    oBox.innerHTML = `<div class="mut">–í–Ω–µ—Å–∏ admin –∫–æ–¥ –∑–∞ –¥–∞ –≥–∏ –≥–ª–µ–¥–∞—à –Ω–∞—Ä–∞—á–∫–∏—Ç–µ.</div>`;
  }else if(orders.length===0){
    oBox.innerHTML = `<div class="mut">–ù–µ–º–∞ –Ω–∞—Ä–∞—á–∫–∏.</div>`;
  }else{
    oBox.innerHTML = `
      <table>
        <thead>
          <tr><th>–í—Ä–µ–º–µ</th><th>–ö—É–ø—É–≤–∞—á</th><th>–°—Ç–∞–≤–∫–∏</th><th>–í–∫—É–ø–Ω–æ</th></tr>
        </thead>
        <tbody>
          ${orders.slice(0,20).map(o=>{
            const when = new Date(o.at).toLocaleString();
            const items = o.items.map(it=>{
              const p = products.find(x=>x.id===it.pid);
              return `${p ? p.name : it.pid} (${it.size}) x${it.qty}`;
            }).join("<br>");
            return `
              <tr>
                <td>${when}<br><span class="mut">${o.id}</span></td>
                <td>${o.customer.name}<br><span class="mut">${o.customer.phone}</span></td>
                <td>${items}</td>
                <td><b>${money(o.total)}</b></td>
              </tr>
            `;
          }).join("")}
        </tbody>
      </table>
    `;
  }
}

/** =========================
 *  EVENTS
 *  ========================= */
$("q").addEventListener("input", renderProducts);

$("openCart").addEventListener("click", ()=>openCart(true));
$("closeCart").addEventListener("click", ()=>openCart(false));
$("clearCart").addEventListener("click", ()=>{
  if(confirm("–î–∞ —ò–∞ –∏—Å–ø—Ä–∞–∑–Ω–∞–º –∫–æ—à–Ω–∏—á–∫–∞—Ç–∞?")){
    cart = [];
    saveCart(cart);
    updateCartUI();
  }
});
$("checkoutFromCart").addEventListener("click", ()=>openCheckout(true));
$("openCheckout").addEventListener("click", ()=>openCheckout(true));
$("closeCheckout").addEventListener("click", ()=>openCheckout(false));

$("sendEmail").addEventListener("click", ()=>{
  const c = readCustomer(); if(!c) return;
  const body = encodeURIComponent(orderSummaryText(c));
  const subj = encodeURIComponent("–ù–∞—Ä–∞—á–∫–∞ - MertaX Butik");
  window.location.href = `mailto:${SHOP.emailTo}?subject=${subj}&body=${body}`;
});

$("sendWhatsApp").addEventListener("click", ()=>{
  const c = readCustomer(); if(!c) return;
  const txt = encodeURIComponent(orderSummaryText(c));
  // wa.me works with number without +
  window.open(`https://wa.me/${SHOP.whatsappNumber}?text=${txt}`, "_blank");
});

$("confirmOrder").addEventListener("click", ()=>{
  const c = readCustomer(); if(!c) return;
  if(!confirm("–î–∞ —ò–∞ –ø–æ—Ç–≤—Ä–¥–∞–º –Ω–∞—Ä–∞—á–∫–∞—Ç–∞ –∏ –¥–∞ —ò–∞ –Ω–∞–º–∞–ª–∞–º –∑–∞–ª–∏—Ö–∞—Ç–∞?")) return;
  const ok = confirmAndDecrementStock(c);
  if(ok){
    openCheckout(false);
    alert("–ù–∞—Ä–∞—á–∫–∞—Ç–∞ –µ –∑–∞—á—É–≤–∞–Ω–∞ ‚úÖ (–∑–∞–ª–∏—Ö–∞—Ç–∞ –µ –Ω–∞–º–∞–ª–µ–Ω–∞).");
  }
});

$("adminLogin").addEventListener("click", ()=>{
  const pass = $("adminPass").value.trim();
  if(pass === SHOP.adminCode){
    localStorage.setItem(LS_ADMIN, "1");
    $("adminPass").value = "";
    renderAdmin();
    alert("Admin: –Ω–∞—ò–∞–≤–µ–Ω ‚úÖ");
  }else{
    alert("–ü–æ–≥—Ä–µ—à–µ–Ω –∫–æ–¥.");
  }
});
$("adminLogout").addEventListener("click", ()=>{
  localStorage.removeItem(LS_ADMIN);
  renderAdmin();
});
$("resetAll").addEventListener("click", ()=>{
  if(!isAdmin()) return alert("–ü—Ä–≤–æ –Ω–∞—ò–∞–≤–∏ —Å–µ –∫–∞–∫–æ admin.");
  if(confirm("–û–≤–∞ —ú–µ —Ä–µ—Å–µ—Ç–∏—Ä–∞ —Å√® (–∑–∞–ª–∏—Ö–∞, –∫–æ—à–Ω–∏—á–∫–∞, –Ω–∞—Ä–∞—á–∫–∏). –°–∏–≥—É—Ä–Ω–æ?")){
    localStorage.removeItem(LS_PRODUCTS);
    localStorage.removeItem(LS_CART);
    localStorage.removeItem(LS_ORDERS);
    products = loadProducts();
    cart = loadCart();
    renderProducts();
    updateCartUI();
    renderAdmin();
    alert("–†–µ—Å–µ—Ç–∏—Ä–∞–Ω–æ ‚úÖ");
  }
});

window.addEventListener("hashchange", renderAdmin);

/** =========================
 *  INIT
 *  ========================= */
renderProducts();
updateCartUI();
renderAdmin();
</script>
</body>
</html>

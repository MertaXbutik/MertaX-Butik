<!doctype html>
<html lang="mk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MertaX Butik</title>
  <style>
    :root{
      --bg:#0b0b0b;
      --bg2:#0f2a22;
      --card:rgba(18,18,18,.65);
      --line:rgba(255,255,255,.10);
      --txt:#fff;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.55);
      --accent:#22c55e;
      --accent2:#16a34a;
      --danger:#ef4444;
      --shadow:0 18px 40px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--txt);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 700px at 15% 25%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(900px 650px at 85% 35%, rgba(6,182,212,.14), transparent 55%),
        linear-gradient(180deg, var(--bg) 0%, #060606 55%, var(--bg2) 100%);
      min-height:100vh;
    }

    /* HEADER like Metro */
    .top{
      position:sticky; top:0; z-index:50;
      background:rgba(10,10,10,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .top-inner{
      max-width:1200px;
      margin:0 auto;
      padding:10px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
    }
    .left{
      display:flex; align-items:center; gap:10px; min-width:0;
    }
    .hamb{
      width:42px; height:42px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      display:grid; place-items:center;
      cursor:pointer;
    }
    .hamb svg{opacity:.9}
    .brand{
      display:flex; align-items:center; gap:10px; min-width:0;
      cursor:pointer;
      user-select:none;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      flex:0 0 44px;
      display:flex; align-items:center; justify-content:center;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:contain;
      background:#fff;
      padding:4px;
      display:block;
    }
    .btxt{line-height:1.05}
    .btxt .title{font-weight:900; font-size:20px; letter-spacing:.2px}
    .btxt .sub{font-size:12.5px; color:var(--muted2)}
    .search{
      flex:1;
      max-width:520px;
      display:flex; gap:10px; align-items:center;
      margin-left:10px;
    }
    .search input{
      width:100%;
      height:42px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      padding:0 14px;
      outline:none;
    }
    .actions{
      display:flex; align-items:center; gap:8px;
    }
    .chip{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      padding:8px 10px;
      border-radius:999px;
      font-size:12.5px;
      color:var(--muted);
      max-width:48vw;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.07);
      color:var(--txt);
      border-radius:12px;
      height:42px;
      padding:0 12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn.primary{background:rgba(34,197,94,.14); border-color:rgba(34,197,94,.35)}
    .btn.danger{background:rgba(239,68,68,.14); border-color:rgba(239,68,68,.35)}
    .btn:active{transform: translateY(1px)}

    /* layout */
    .wrap{
      max-width:1200px;
      margin:16px auto 40px;
      padding:0 14px;
      display:grid;
      grid-template-columns: 1.05fr 1.75fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
      .search{display:none}
    }

    .panel{
      border:1px solid var(--line);
      border-radius:var(--r);
      background:var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-h{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .panel-h h2{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .muted{color:var(--muted2); font-size:12.5px; margin-top:4px}
    .panel-b{padding:14px}
    .howto{
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
      margin:8px 0 10px;
    }

    .filters{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }
    select, input[type="number"], input[type="text"], textarea{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
    textarea{width:100%}
    .small{font-size:12px; color:var(--muted2)}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .field{flex:1; min-width:220px}
    label{display:block; font-size:12px; color:var(--muted2); margin-bottom:6px}

    /* product cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 560px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:18px;
      overflow:hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      display:flex;
      flex-direction:column;
      min-height:360px;
    }
    .imgwrap{
      position:relative;
      aspect-ratio: 16/10;
      background:rgba(255,255,255,.03);
      overflow:hidden;
    }
    .imgwrap img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .badge{
      position:absolute;
      top:10px; left:10px;
      padding:7px 10px;
      border-radius:999px;
      font-weight:800;
      font-size:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
    }
    .cardbody{padding:12px}
    .pname{font-size:18px; font-weight:900; margin:0 0 6px}
    .price{font-size:18px; font-weight:900; color:rgba(34,197,94,.95)}
    .meta{display:flex; justify-content:space-between; gap:10px; color:var(--muted2); font-size:12.5px; margin-top:6px}
    .sizes{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
    }
    .sz{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:999px;
      padding:6px 8px;
      font-size:12px;
      color:var(--muted);
      display:inline-flex;
      gap:6px;
      align-items:center;
    }
    .dot{
      width:8px; height:8px; border-radius:99px;
      background:rgba(34,197,94,.9);
    }
    .dot.out{background:rgba(239,68,68,.9)}
    .cardfoot{
      margin-top:auto;
      padding:12px;
      border-top:1px solid var(--line);
      display:flex; gap:10px;
    }
    .cardfoot .btn{flex:1}

    /* MODALS */
    .modal{
      position:fixed; inset:0;
      background:rgba(0,0,0,.62);
      backdrop-filter: blur(8px);
      display:none;
      z-index:999;
      padding:14px;
      overflow:auto;
    }
    .modal.open{display:block}
    .modal-card{
      max-width:720px;
      margin:24px auto;
      background:rgba(18,18,18,.86);
      border:1px solid rgba(255,255,255,.12);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modal-head h3{margin:0; font-size:18px}
    .modal-body{padding:14px}
    .divider{height:1px; background:rgba(255,255,255,.10); margin:12px 0}
    .help{font-size:12px; color:var(--muted2); line-height:1.35}

    .mini{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,.04); color:var(--muted)}
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="top">
    <div class="top-inner">
      <div class="left">
        <button class="hamb" id="btnCats" title="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M4 7h16M4 12h16M4 17h16" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <div class="brand" id="brandClick" title="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏">
          <div class="logo">
            <img src="IMG_9833.jpeg" alt="MertaX Butik –ª–æ–≥–æ" />
          </div>
          <div class="btxt">
            <div class="title">MertaX Butik</div>
            <div class="sub">–û–Ω–ª–∞—ò–Ω –Ω–∞—Ä–∞—á–∫–∏ –ø—Ä–µ–∫—É WhatsApp ‚Ä¢ –í–µ–ª–∏—á–∏–Ω–∏ ‚Ä¢ –ó–∞–ª–∏—Ö–∞</div>
          </div>
        </div>
      </div>

      <div class="search">
        <input id="qTop" type="text" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò –ø—Ä–æ–¥—É–∫—Ç..." />
      </div>

      <div class="actions">
        <span class="chip" id="chipCat">–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞: (—Å–∏—Ç–µ)</span>
        <button class="btn primary" id="btnAdd">+ –ü—Ä–æ–¥—É–∫—Ç</button>
        <button class="btn" id="btnAdmin">Admin</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- LEFT PANEL -->
    <div class="panel">
      <div class="panel-h">
        <div>
          <h2>–ü—Ä–æ–¥—É–∫—Ç–∏</h2>
          <div class="muted" id="prodInfo">0 –ø—Ä–æ–¥—É–∫—Ç–∏</div>
          <div class="howto">
            <b>–ö–∞–∫–æ –¥–∞ –Ω–∞—Ä–∞—á–∞—à?</b><br/>
            1) –ò–∑–±–µ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç ‚Üí 2) –ü—Ä–∏—Ç–∏—Å–Ω–∏ ‚Äû–ù–∞—Ä–∞—á–∞—ò‚Äú ‚Üí 3) –ò–∑–±–µ—Ä–∏ –≤–µ–ª–∏—á–∏–Ω–∞ –∏ –∫–æ–ª–∏—á–∏–Ω–∞ ‚Üí
            4) –ü–æ—Ç–≤—Ä–¥–∏ ‚Üí WhatsApp —ú–µ —Å–µ –æ—Ç–≤–æ—Ä–∏ —Å–æ –≥–æ—Ç–æ–≤–∞ –ø–æ—Ä–∞–∫–∞.
          </div>
        </div>
      </div>

      <div class="panel-b">
        <div class="filters">
          <input id="q" type="text" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò –ø—Ä–æ–¥—É–∫—Ç..." style="flex:1; min-width:220px" />
          <select id="sizeFilter">
            <option value="">–§–∏–ª—Ç–µ—Ä –ø–æ –≤–µ–ª–∏—á–∏–Ω–∞ (—Å–∞–º–æ –¥–æ—Å—Ç–∞–ø–Ω–∏)</option>
          </select>
          <button class="btn" id="btnResetFilters">Reset</button>
        </div>

        <div class="divider"></div>

        <div class="small">üì± –ù–∞—Ä–∞—á–∫–∞ = WhatsApp –ø–æ—Ä–∞–∫–∞ (–ø—Ä–æ–¥—É–∫—Ç + —Ü–µ–Ω–∞ + –≤–µ–ª–∏—á–∏–Ω–∞ + –∫–æ–ª–∏—á–∏–Ω–∞)</div>
        <div class="small" style="margin-top:6px;">üß† –ü–æ–¥–∞—Ç–æ—Ü–∏ –ª–æ–∫–∞–ª–Ω–æ (localStorage) ‚Äî –æ—Å—Ç–∞–Ω—É–≤–∞–∞—Ç –Ω–∞ –∏—Å—Ç–∏–æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω/PC.</div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel">
      <div class="panel-h">
        <div>
          <h2 id="listTitle">–õ–∏—Å—Ç–∞</h2>
          <div class="muted" id="listSub">–ò–∑–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞ –æ–¥ ‚ò∞ –∏–ª–∏ –ø—Ä–µ–±–∞—Ä–∞—ò.</div>
        </div>
        <div class="row" style="gap:8px; align-items:center">
          <span class="mini" id="demoTag">DEMO</span>
        </div>
      </div>
      <div class="panel-b">
        <div class="grid" id="grid"></div>
        <div class="muted" id="empty" style="display:none; padding:18px 6px;">–ù–µ–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ –∏–∑–±—Ä–∞–Ω–∏–æ—Ç —Ñ–∏–ª—Ç–µ—Ä.</div>
      </div>
    </div>
  </div>

  <!-- MODAL: Categories -->
  <div class="modal" id="modalCats">
    <div class="modal-card">
      <div class="modal-head">
        <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
        <button class="btn" onclick="UI.close('modalCats')">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
      <div class="modal-body" id="catsList"></div>
    </div>
  </div>

  <!-- MODAL: Order -->
  <div class="modal" id="modalOrder">
    <div class="modal-card">
      <div class="modal-head">
        <h3>–ù–∞—Ä–∞—á–∫–∞</h3>
        <button class="btn" onclick="UI.close('modalOrder')">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
      <div class="modal-body">
        <div class="row" style="gap:12px; align-items:flex-start">
          <img id="oImg" alt="" style="width:120px; height:90px; object-fit:cover; border-radius:14px; border:1px solid rgba(255,255,255,.12)" />
          <div style="flex:1; min-width:220px">
            <div id="oTitle" style="font-weight:900; font-size:18px"></div>
            <div class="muted" id="oCat"></div>
            <div style="margin-top:6px; font-weight:900; color:rgba(34,197,94,.95)" id="oPrice"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label>–í–µ–ª–∏—á–∏–Ω–∞ (—Å–∞–º–æ –¥–æ—Å—Ç–∞–ø–Ω–∏)</label>
            <select id="oSize"></select>
          </div>
          <div class="field">
            <label>–ö–æ–ª–∏—á–∏–Ω–∞</label>
            <input id="oQty" type="number" min="1" value="1" />
            <div class="help" id="oHint" style="margin-top:6px;"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label>–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ</label>
            <input id="cName" type="text" placeholder="–ü—Ä–∏–º–µ—Ä: –ï—Ä–µ–Ω –¢—É–Ω–∞" />
          </div>
          <div class="field">
            <label>–ì—Ä–∞–¥ / –ê–¥—Ä–µ—Å–∞</label>
            <input id="cAddr" type="text" placeholder="–ü—Ä–∏–º–µ—Ä: –°–∫–æ–ø—ò–µ, –ê–µ—Ä–æ–¥—Ä–æ–º..." />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>–ó–∞–±–µ–ª–µ—à–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)</label>
            <textarea id="cNote" placeholder="–ë–æ—ò–∞, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª–Ω–∏ –±–∞—Ä–∞—ö–∞..."></textarea>
          </div>
        </div>

        <div class="row" style="gap:10px; margin-top:10px">
          <button class="btn primary" id="btnSendWA">–ü–æ—Ç–≤—Ä–¥–∏ & –æ—Ç–≤–æ—Ä–∏ WhatsApp</button>
          <button class="btn danger" onclick="UI.close('modalOrder')">–û—Ç–∫–∞–∂–∏</button>
        </div>

        <div class="help" style="margin-top:10px">
          * –ü–æ –ø–æ—Ç–≤—Ä–¥–∞, –∑–∞–ª–∏—Ö–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏ —Å–µ –Ω–∞–º–∞–ª—É–≤–∞ –∑–∞ –∏–∑–±—Ä–∞–Ω–∞—Ç–∞ –≤–µ–ª–∏—á–∏–Ω–∞.
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Add product -->
  <div class="modal" id="modalAdd">
    <div class="modal-card">
      <div class="modal-head">
        <h3>–î–æ–¥–∞—ò –ø—Ä–æ–¥—É–∫—Ç</h3>
        <button class="btn" onclick="UI.close('modalAdd')">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="field">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞</label>
            <select id="aCat"></select>
          </div>
          <div class="field">
            <label>–ò–º–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç</label>
            <input id="aName" type="text" placeholder="–ü—Ä–∏–º–µ—Ä: Nike —Ç—Ä–µ–Ω–µ—Ä–∫–∞" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>–¶–µ–Ω–∞ (–¥–µ–Ω)</label>
            <input id="aPrice" type="number" min="0" value="1990" />
          </div>
          <div class="field">
            <label>–°–ª–∏–∫–∏ (3‚Äì5 URL –∏–ª–∏ –ø—Ä–∞–∑–Ω–æ = –∞–≤—Ç–æ)</label>
            <input id="aImgs" type="text" placeholder="URL1, URL2, URL3 ..." />
            <div class="help">–ú–æ–∂–µ—à –∏ –ø–æ–¥–æ—Ü–Ω–∞ –¥–∞ –º–µ–Ω—É–≤–∞—à –≤–æ –∫–æ–¥/–∞–¥–º–∏–Ω.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label>–¢–∏–ø –Ω–∞ –≤–µ–ª–∏—á–∏–Ω–∏</label>
            <select id="aSizeMode">
              <option value="clothes">S‚Äì3XL</option>
              <option value="jeans">–§–∞—Ä–º–µ—Ä–∫–∏ 30‚Äì42</option>
            </select>
            <div class="help">* –ó–∞ ‚Äû–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏‚Äú –∏–∑–±–µ—Ä–∏ jeans.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row" id="stockGrid" style="gap:10px"></div>

        <div class="row" style="gap:10px; margin-top:12px">
          <button class="btn primary" id="btnSaveProduct">–ó–∞—á—É–≤–∞—ò</button>
          <button class="btn" onclick="UI.close('modalAdd')">–û—Ç–∫–∞–∂–∏</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Admin -->
  <div class="modal" id="modalAdmin">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Admin</h3>
        <button class="btn" onclick="UI.close('modalAdmin')">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="field">
            <label>Admin PIN (–ø—Ä–∏–º–µ—Ä 1234)</label>
            <input id="pin" type="number" placeholder="PIN" />
            <div class="help">PIN –µ –ª–æ–∫–∞–ª–µ–Ω, —Å–∞–º–æ –Ω–∞ —Ç–≤–æ—ò–æ—Ç —É—Ä–µ–¥.</div>
          </div>
          <div class="field">
            <label>–ö–æ–ø—á–µ</label>
            <button class="btn primary" id="btnSetPin">–°–Ω–∏–º–∏ PIN</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label>–î–µ–º–æ –ø—Ä–æ–¥—É–∫—Ç–∏</label>
            <button class="btn danger" id="btnResetDemo">Reset demo (–≥–∏ –±—Ä–∏—à–µ —Å–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏)</button>
            <div class="help">‚ö†Ô∏è –û–≤–∞ —ú–µ –∏–∑–±—Ä–∏—à–µ —Å√® –æ–¥ localStorage –Ω–∞ —Ç–æ—ò —É—Ä–µ–¥.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ===========================
   CONFIG
=========================== */
const WA_PHONE = "38972912601"; // —Ç–≤–æ—ò WhatsApp –±—Ä–æ—ò
const LS_KEY = "mertax_butik_v3";

/* ===========================
   DATA / HELPERS
=========================== */
const SIZES_CLOTHES = ["S","M","L","XL","2XL","3XL"];
const SIZES_JEANS   = ["30","31","32","33","34","36","38","40","42"];

const CATS = [
  { id:"cemperi", name:"–ß–µ–º–ø–µ—Ä–∏", sizeMode:"clothes", demoCount:150 },
  { id:"maicki", name:"–ú–∞–∏—á–∫–∏", sizeMode:"clothes", demoCount:150 },
  { id:"trenerki", name:"–¢—Ä–µ–Ω–µ—Ä–∫–∏", sizeMode:"clothes", demoCount:70  },
  { id:"jakni", name:"–à–∞–∫–Ω–∏", sizeMode:"clothes", demoCount:70  },
  { id:"odela", name:"–û–¥–µ–ª–∞", sizeMode:"clothes", demoCount:70  },
  { id:"bluzoni", name:"–ë–ª—É–∑–æ–Ω–∏", sizeMode:"clothes", demoCount:150 },
  { id:"farmerki", name:"–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏", sizeMode:"jeans", demoCount:150 },
  { id:"patiki", name:"–ü–∞—Ç–∏–∫–∏", sizeMode:"clothes", demoCount:150 }
];

function uid(){ return Math.random().toString(16).slice(2)+Date.now().toString(16); }
function money(n){
  const x = Number(n||0);
  return x.toLocaleString("mk-MK") + " –¥–µ–Ω";
}
function now(){ return Date.now(); }

function rint(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

function makePics(seed, count){
  // –±–µ—Å–ø–ª–∞—Ç–Ω–∏ placeholder (–±–µ–∑ –¥–∞ –º–æ—Ä–∞—à –¥–∞ –∫–∞—á—É–≤–∞—à —Å–ª–∏–∫–∏)
  // –º–æ–∂–µ—à –ø–æ–¥–æ—Ü–Ω–∞ –¥–∞ —Å–º–µ–Ω–∏—à —Å–æ —Ç–≤–æ–∏ URL
  const arr=[];
  for(let i=0;i<count;i++){
    arr.push(`https://picsum.photos/seed/${seed}_${i}/900/600`);
  }
  return arr;
}
function defaultStock(mode){
  const sizes = mode==="jeans" ? SIZES_JEANS : SIZES_CLOTHES;
  const stock = {};
  sizes.forEach(s=>{
    // –¥–µ–º–æ –∑–∞–ª–∏—Ö–∞ (0-6)
    stock[s] = rint(0,6);
  });
  // –¥–∞ –∏–º–∞ –±–∞—Ä–µ–º –Ω–µ—à—Ç–æ
  if(Object.values(stock).every(v=>v===0)){
    stock[sizes[rint(0,sizes.length-1)]] = rint(1,4);
  }
  return stock;
}

function load(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){
    return null;
  }
}
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

function catById(id){ return CATS.find(c=>c.id===id) || null; }

function totalAvailable(p){
  return Object.values(p.stock||{}).reduce((a,b)=>a+Number(b||0),0);
}

function sizesFor(p){
  return p.sizeMode==="jeans" ? SIZES_JEANS : SIZES_CLOTHES;
}

/* ===========================
   STATE
=========================== */
let state = load() || {
  adminPin: "",          // –ª–æ–∫–∞–ª–Ω–æ
  selectedCat: "",       // catId
  q: "",
  sizeFilter: "",
  products: [],
  demoSeeded: false
};

/* ===========================
   DEMO SEED
=========================== */
function seedDemoProducts(){
  const products=[];
  const baseNames = {
    "–ß–µ–º–ø–µ—Ä–∏":"–ß–µ–º–ø–µ—Ä",
    "–ú–∞–∏—á–∫–∏":"–ú–∞–∏—á–∫–∞",
    "–¢—Ä–µ–Ω–µ—Ä–∫–∏":"–¢—Ä–µ–Ω–µ—Ä–∫–∞",
    "–à–∞–∫–Ω–∏":"–à–∞–∫–Ω–∞",
    "–û–¥–µ–ª–∞":"–û–¥–µ–ª–æ",
    "–ë–ª—É–∑–æ–Ω–∏":"–ë–ª—É–∑–æ–Ω",
    "–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏":"–§–∞—Ä–º–µ—Ä–∫–∏",
    "–ü–∞—Ç–∏–∫–∏":"–ü–∞—Ç–∏–∫–∏"
  };

  CATS.forEach((cat, ci)=>{
    const count = cat.demoCount;
    for(let i=1;i<=count;i++){
      const base = baseNames[cat.name] || "–ü—Ä–æ–¥—É–∫—Ç";
      const nm = `${base} #${i}`;
      let price;
      if(cat.id==="patiki") price = rint(1990, 6990);
      else if(cat.id==="farmerki") price = rint(1790, 4490);
      else if(cat.id==="jakni") price = rint(2990, 8990);
      else if(cat.id==="odela") price = rint(3990, 12990);
      else price = rint(1190, 4990);

      const imgCount = rint(3,5);
      const pSeed = `${cat.id}_${i}_${now()}`;

      products.push({
        id: uid(),
        name: nm,
        catId: cat.id,
        price,
        images: makePics(pSeed, imgCount),
        sizeMode: cat.sizeMode,
        stock: defaultStock(cat.sizeMode),
        createdAt: now() + (ci*100000) + i
      });
    }
  });

  state.products = products;
  state.demoSeeded = true;
  save();
}

/* seed –∞–∫–æ –Ω–µ–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ */
if(!state.products || state.products.length===0){
  seedDemoProducts();
}

/* ===========================
   UI
=========================== */
const UI = {
  open(id){ document.getElementById(id).classList.add("open"); },
  close(id){ document.getElementById(id).classList.remove("open"); },
  toast(msg){
    alert(msg);
  }
};

function renderCats(){
  const el = document.getElementById("catsList");
  el.innerHTML = "";
  CATS.forEach(c=>{
    const count = state.products.filter(p=>p.catId===c.id).length;
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.style.width = "100%";
    btn.style.height = "56px";
    btn.style.display = "flex";
    btn.style.justifyContent = "space-between";
    btn.style.alignItems = "center";
    btn.style.borderRadius = "16px";
    btn.style.marginBottom = "10px";
    btn.innerHTML = `<span style="font-weight:900">${c.name}</span><span class="chip" style="max-width:none">${count}</span>`;
    btn.onclick = ()=>{
      state.selectedCat = c.id;
      save();
      UI.close("modalCats");
      renderAll();
    };
    el.appendChild(btn);
  });

  const btnAll = document.createElement("button");
  btnAll.className = "btn";
  btnAll.style.width="100%";
  btnAll.style.height="56px";
  btnAll.style.borderRadius="16px";
  btnAll.innerHTML = `<span style="font-weight:900">–°–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>`;
  btnAll.onclick = ()=>{
    state.selectedCat = "";
    save();
    UI.close("modalCats");
    renderAll();
  };
  el.appendChild(btnAll);
}

function buildSizeFilterOptions(){
  const sel = document.getElementById("sizeFilter");
  const cur = state.sizeFilter || "";
  sel.innerHTML = `<option value="">–§–∏–ª—Ç–µ—Ä –ø–æ –≤–µ–ª–∏—á–∏–Ω–∞ (—Å–∞–º–æ –¥–æ—Å—Ç–∞–ø–Ω–∏)</option>`;

  // –¥–æ–∑–≤–æ–ª–∏ –≤–µ–ª–∏—á–∏–Ω–∏ —à—Ç–æ –ø–æ—Å—Ç–æ—ò–∞—Ç –≤–æ –º–æ–º–µ–Ω—Ç–Ω–∞—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞
  let possible = new Set();
  filteredProductsBase().forEach(p=>{
    Object.entries(p.stock||{}).forEach(([k,v])=>{
      if(Number(v)>0) possible.add(k);
    });
  });

  Array.from(possible).sort((a,b)=>{
    // clothes order first if matches
    const A = SIZES_CLOTHES.indexOf(a); const B = SIZES_CLOTHES.indexOf(b);
    const AJ = SIZES_JEANS.indexOf(a);  const BJ = SIZES_JEANS.indexOf(b);
    if(A!==-1 && B!==-1) return A-B;
    if(AJ!==-1 && BJ!==-1) return AJ-BJ;
    return (""+a).localeCompare(""+b);
  }).forEach(s=>{
    const op = document.createElement("option");
    op.value = s;
    op.textContent = s;
    sel.appendChild(op);
  });

  sel.value = cur;
}

function filteredProductsBase(){
  let arr = [...state.products];

  if(state.selectedCat){
    arr = arr.filter(p=>p.catId===state.selectedCat);
  }

  const q = (state.q||"").trim().toLowerCase();
  if(q){
    arr = arr.filter(p => (p.name||"").toLowerCase().includes(q));
  }

  return arr;
}

function filteredProducts(){
  let arr = filteredProductsBase();

  const sf = state.sizeFilter || "";
  if(sf){
    arr = arr.filter(p => Number((p.stock||{})[sf]||0) > 0);
  }

  // –∞–∫–æ category set, –ø–æ–∫–∞–∂–∏ –Ω–∞—ò–Ω–æ–≤–∏ –ø—Ä–≤–æ
  arr.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
  return arr;
}

function renderGrid(){
  const grid = document.getElementById("grid");
  const empty = document.getElementById("empty");
  const arr = filteredProducts();
  grid.innerHTML = "";

  if(arr.length===0){
    empty.style.display="block";
    return;
  }
  empty.style.display="none";

  arr.slice(0, 120).forEach(p=>{
    const card = document.createElement("div");
    card.className = "card";

    const img = (p.images && p.images[0]) ? p.images[0] : "https://picsum.photos/seed/x/900/600";
    const cat = catById(p.catId)?.name || "";
    const avail = totalAvailable(p);

    const sizesHtml = sizesFor(p).map(s=>{
      const v = Number((p.stock||{})[s]||0);
      const dotClass = v>0 ? "dot" : "dot out";
      return `<span class="sz"><span class="${dotClass}"></span>${s} <span style="opacity:.8">(${v})</span></span>`;
    }).join("");

    card.innerHTML = `
      <div class="imgwrap">
        <img src="${img}" alt="">
        <div class="badge">${cat}</div>
      </div>
      <div class="cardbody">
        <div class="pname">${escapeHtml(p.name||"")}</div>
        <div class="price">${money(p.price)}</div>
        <div class="meta">
          <div>–î–æ—Å—Ç–∞–ø–Ω–æ: <b>${avail}</b></div>
          <div>${p.sizeMode==="jeans" ? "Jeans" : "S‚Äì3XL"}</div>
        </div>
        <div class="sizes">${sizesHtml}</div>
      </div>
      <div class="cardfoot">
        <button class="btn primary" ${avail<=0 ? "disabled" : ""}>–ù–∞—Ä–∞—á–∞—ò</button>
        <button class="btn">–î–µ—Ç–∞–ª–∏</button>
      </div>
    `;

    const [btnOrder, btnDetails] = card.querySelectorAll("button");
    btnOrder.onclick = ()=> openOrderModal(p);
    btnDetails.onclick = ()=> openOrderModal(p);

    if(avail<=0){
      btnOrder.classList.remove("primary");
      btnOrder.textContent = "–ù–µ–º–∞ –∑–∞–ª–∏—Ö–∞";
      btnOrder.disabled = true;
    }

    grid.appendChild(card);
  });
}

function renderTopInfo(){
  const prodInfo = document.getElementById("prodInfo");
  const listTitle = document.getElementById("listTitle");
  const listSub = document.getElementById("listSub");
  const chipCat = document.getElementById("chipCat");

  const total = state.products.length;
  prodInfo.textContent = `${total} –ø—Ä–æ–¥—É–∫—Ç–∏`;

  const cat = state.selectedCat ? (catById(state.selectedCat)?.name || "") : "(—Å–∏—Ç–µ)";
  chipCat.textContent = `–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞: ${cat}`;

  if(state.selectedCat){
    listTitle.textContent = cat;
    listSub.textContent = `–ü—Ä–µ–±–∞—Ä–∞—ò –∏–ª–∏ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞—ò –ø–æ –≤–µ–ª–∏—á–∏–Ω–∞ (—Å–∞–º–æ –¥–æ—Å—Ç–∞–ø–Ω–∏).`;
  }else{
    listTitle.textContent = "–°–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏";
    listSub.textContent = "–ò–∑–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞ –æ–¥ ‚ò∞ –∏–ª–∏ –ø—Ä–µ–±–∞—Ä–∞—ò.";
  }
}

function renderAll(){
  renderCats();
  buildSizeFilterOptions();
  renderTopInfo();
  renderGrid();
}

/* ===========================
   ORDER FLOW (WhatsApp + stock decrement)
=========================== */
let orderState = { prodId:null };

function openOrderModal(p){
  orderState.prodId = p.id;

  document.getElementById("oImg").src = (p.images && p.images[0]) ? p.images[0] : "https://picsum.photos/seed/x/900/600";
  document.getElementById("oTitle").textContent = p.name || "";
  document.getElementById("oCat").textContent = catById(p.catId)?.name || "";
  document.getElementById("oPrice").textContent = money(p.price);

  const sel = document.getElementById("oSize");
  sel.innerHTML = "";
  const sizes = sizesFor(p);

  // —Å–∞–º–æ –¥–æ—Å—Ç–∞–ø–Ω–∏ –≤–µ–ª–∏—á–∏–Ω–∏
  const avail = sizes.filter(s=>Number((p.stock||{})[s]||0)>0);
  avail.forEach(s=>{
    const v = Number((p.stock||{})[s]||0);
    const op = document.createElement("option");
    op.value = s;
    op.textContent = `${s} (${v} –Ω–∞ –∑–∞–ª–∏—Ö–∞)`;
    sel.appendChild(op);
  });

  // –∞–∫–æ –Ω–µ–º–∞ –Ω–∏—à—Ç–æ
  if(avail.length===0){
    const op = document.createElement("option");
    op.value = "";
    op.textContent = "–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –≤–µ–ª–∏—á–∏–Ω–∏";
    sel.appendChild(op);
  }

  document.getElementById("oQty").value = 1;
  document.getElementById("oHint").textContent = avail.length
    ? "–ò–∑–±–µ—Ä–∏ –≤–µ–ª–∏—á–∏–Ω–∞ –∏ –∫–æ–ª–∏—á–∏–Ω–∞. –å–µ —Å–µ –Ω–∞–º–∞–ª–∏ –∑–∞–ª–∏—Ö–∞—Ç–∞ –ø–æ –ø–æ—Ç–≤—Ä–¥–∞."
    : "–ù–µ–º–∞ –∑–∞–ª–∏—Ö–∞ –∑–∞ –æ–≤–æ—ò –ø—Ä–æ–¥—É–∫—Ç.";

  UI.open("modalOrder");
}

function buildWhatsAppText(p, size, qty){
  const name = (document.getElementById("cName").value||"").trim();
  const addr = (document.getElementById("cAddr").value||"").trim();
  const note = (document.getElementById("cNote").value||"").trim();
  const cat = catById(p.catId)?.name || "";

  let msg = `–ó–¥—Ä–∞–≤–æ üëã\n\n–°–∞–∫–∞–º –¥–∞ –Ω–∞—Ä–∞—á–∞–º:\n\nüõç –ü—Ä–æ–∏–∑–≤–æ–¥: ${p.name}\nüìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞: ${cat}\nüìè –í–µ–ª–∏—á–∏–Ω–∞: ${size}\nüî¢ –ö–æ–ª–∏—á–∏–Ω–∞: ${qty}\nüí∞ –¶–µ–Ω–∞: ${money(p.price)}\n`;

  if(name) msg += `\nüë§ –ò–º–µ: ${name}`;
  if(addr) msg += `\nüìç –ê–¥—Ä–µ—Å–∞/–ì—Ä–∞–¥: ${addr}`;
  if(note) msg += `\nüìù –ó–∞–±–µ–ª–µ—à–∫–∞: ${note}`;

  msg += `\n\n–í–µ –º–æ–ª–∞–º –ø–æ—Ç–≤—Ä–¥–µ—Ç–µ –¥–æ—Å—Ç–∞–ø–Ω–æ—Å—Ç.`;
  return msg;
}

function decrementStock(p, size, qty){
  const cur = Number((p.stock||{})[size]||0);
  if(cur < qty) return false;
  p.stock[size] = cur - qty;
  return true;
}

/* ===========================
   ADD PRODUCT
=========================== */
function openAddModal(){
  const aCat = document.getElementById("aCat");
  aCat.innerHTML = "";
  CATS.forEach(c=>{
    const op=document.createElement("option");
    op.value=c.id;
    op.textContent=c.name;
    aCat.appendChild(op);
  });

  // default
  aCat.value = state.selectedCat || CATS[0].id;

  document.getElementById("aName").value = "";
  document.getElementById("aPrice").value = 1990;
  document.getElementById("aImgs").value = "";
  const sizeModeSel = document.getElementById("aSizeMode");
  sizeModeSel.value = (catById(aCat.value)?.sizeMode || "clothes");

  function rebuildStock(){
    const mode = sizeModeSel.value;
    const sizes = mode==="jeans" ? SIZES_JEANS : SIZES_CLOTHES;
    const grid = document.getElementById("stockGrid");
    grid.innerHTML = "";
    sizes.forEach(s=>{
      const d = document.createElement("div");
      d.className="field";
      d.style.minWidth="140px";
      d.innerHTML = `
        <label>–ó–∞–ª–∏—Ö–∞ ${s}</label>
        <input type="number" min="0" value="0" data-size="${s}">
      `;
      grid.appendChild(d);
    });
  }

  rebuildStock();
  aCat.onchange = ()=>{
    const cm = catById(aCat.value)?.sizeMode || "clothes";
    sizeModeSel.value = cm;
    rebuildStock();
  };
  sizeModeSel.onchange = rebuildStock;

  UI.open("modalAdd");
}

function saveNewProduct(){
  const catId = document.getElementById("aCat").value;
  const name = (document.getElementById("aName").value||"").trim();
  const price = Number(document.getElementById("aPrice").value||0);
  const imgsRaw = (document.getElementById("aImgs").value||"").trim();
  const sizeMode = document.getElementById("aSizeMode").value;

  if(!name){
    UI.toast("–í–Ω–µ—Å–∏ –∏–º–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç.");
    return;
  }

  let images = [];
  if(imgsRaw){
    images = imgsRaw.split(",").map(x=>x.trim()).filter(Boolean).slice(0,5);
  }else{
    images = makePics("custom_"+uid(), rint(3,5));
  }

  const stock = {};
  document.querySelectorAll("#stockGrid input[data-size]").forEach(inp=>{
    const s = inp.getAttribute("data-size");
    stock[s] = Math.max(0, Number(inp.value||0));
  });

  // –∞–∫–æ —Å–∏—Ç–µ 0, —Å—Ç–∞–≤–∏ 1 –Ω–∞ –ø—Ä–≤–∞—Ç–∞
  if(Object.values(stock).every(v=>Number(v)===0)){
    const first = (sizeMode==="jeans" ? SIZES_JEANS[0] : SIZES_CLOTHES[0]);
    stock[first] = 1;
  }

  state.products.unshift({
    id: uid(),
    name,
    catId,
    price,
    images,
    sizeMode,
    stock,
    createdAt: now()
  });

  save();
  UI.close("modalAdd");
  renderAll();
  UI.toast("–ü—Ä–æ–¥—É–∫—Ç–æ—Ç –µ –¥–æ–¥–∞–¥–µ–Ω ‚úÖ");
}

/* ===========================
   ADMIN
=========================== */
function isAdminOk(){
  const pin = (document.getElementById("pin").value||"").trim();
  return pin && state.adminPin && pin === state.adminPin;
}

function resetDemo(){
  if(!isAdminOk()){
    UI.toast("–ü–æ–≥—Ä–µ—à–µ–Ω PIN.");
    return;
  }
  if(!confirm("–û–≤–∞ —ú–µ –∏–∑–±—Ä–∏—à–µ –°–ò–¢–ï –ø—Ä–æ–¥—É–∫—Ç–∏ –Ω–∞ –æ–≤–æ—ò —É—Ä–µ–¥. –°–∏–≥—É—Ä–Ω–æ?")) return;
  localStorage.removeItem(LS_KEY);
  state = {
    adminPin: state.adminPin,
    selectedCat: "",
    q: "",
    sizeFilter: "",
    products: [],
    demoSeeded: false
  };
  seedDemoProducts();
  renderAll();
  UI.close("modalAdmin");
  UI.toast("Reset –Ω–∞–ø—Ä–∞–≤–µ–Ω ‚úÖ");
}

/* ===========================
   EVENTS
=========================== */
document.getElementById("btnCats").onclick = ()=> UI.open("modalCats");
document.getElementById("brandClick").onclick = ()=> UI.open("modalCats");

document.getElementById("q").addEventListener("input", (e)=>{
  state.q = e.target.value || "";
  document.getElementById("qTop").value = state.q;
  save();
  buildSizeFilterOptions();
  renderGrid();
});
document.getElementById("qTop").addEventListener("input", (e)=>{
  state.q = e.target.value || "";
  document.getElementById("q").value = state.q;
  save();
  buildSizeFilterOptions();
  renderGrid();
});

document.getElementById("sizeFilter").addEventListener("change", (e)=>{
  state.sizeFilter = e.target.value || "";
  save();
  renderGrid();
});

document.getElementById("btnResetFilters").onclick = ()=>{
  state.q = "";
  state.sizeFilter = "";
  document.getElementById("q").value = "";
  document.getElementById("qTop").value = "";
  save();
  buildSizeFilterOptions();
  renderGrid();
};

document.getElementById("btnAdd").onclick = ()=> openAddModal();
document.getElementById("btnSaveProduct").onclick = ()=> saveNewProduct();

document.getElementById("btnAdmin").onclick = ()=> UI.open("modalAdmin");
document.getElementById("btnSetPin").onclick = ()=>{
  const pin = (document.getElementById("pin").value||"").trim();
  if(!pin || pin.length<3){
    UI.toast("–°—Ç–∞–≤–∏ PIN (–Ω–∞ –ø—Ä–∏–º–µ—Ä 1234).");
    return;
  }
  state.adminPin = pin;
  save();
  UI.toast("PIN –∑–∞—á—É–≤–∞–Ω ‚úÖ");
};

document.getElementById("btnResetDemo").onclick = ()=> resetDemo();

document.getElementById("btnSendWA").onclick = ()=>{
  const p = state.products.find(x=>x.id===orderState.prodId);
  if(!p){ UI.toast("–ì—Ä–µ—à–∫–∞: –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –µ –Ω–∞—ò–¥–µ–Ω."); return; }

  const size = document.getElementById("oSize").value;
  const qty  = Math.max(1, Number(document.getElementById("oQty").value||1));

  if(!size){
    UI.toast("–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∞ –≤–µ–ª–∏—á–∏–Ω–∞.");
    return;
  }

  const ok = decrementStock(p, size, qty);
  if(!ok){
    UI.toast("–ù–µ–º–∞ –¥–æ–≤–æ–ª–Ω–∞ –∑–∞–ª–∏—Ö–∞ –∑–∞ —Ç–∞–∞ –∫–æ–ª–∏—á–∏–Ω–∞.");
    return;
  }

  save();
  renderAll();
  UI.close("modalOrder");

  const text = buildWhatsAppText(p, size, qty);
  const url = `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
};

/* close modal on background click */
["modalCats","modalOrder","modalAdd","modalAdmin"].forEach(id=>{
  const m = document.getElementById(id);
  m.addEventListener("click",(e)=>{
    if(e.target===m) UI.close(id);
  });
});

/* ===========================
   SAFE HTML
=========================== */
function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* init */
document.getElementById("q").value = state.q || "";
document.getElementById("qTop").value = state.q || "";
renderAll();
</script>
</body>
</html>

<!doctype html>
<html lang="mk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MertaX Butik</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#121420; --muted:#a9a9b3; --txt:#fff;
      --accent:#22c55e; --danger:#ef4444; --line:#23263a; --chip:#1b1e2f;
      --shadow:0 16px 40px rgba(0,0,0,.45); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(34,197,94,.18), transparent 50%),
        radial-gradient(900px 500px at 100% 0%, rgba(239,68,68,.10), transparent 45%),
        var(--bg);
      color:var(--txt);
    }
    header{
      background:rgba(0,0,0,.65);
      backdrop-filter:blur(8px);
      padding:14px;
      position:sticky; top:0; z-index:50;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .headRow{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .brand{font-size:20px;font-weight:900;letter-spacing:.6px}
    .headBtns{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{
      border:0;cursor:pointer;padding:11px 13px;border-radius:14px;font-weight:900;
      background:var(--chip);color:#fff
    }
    .btn-accent{background:var(--accent);color:#041a0b}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.12)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin:12px 0 14px}
    .badge{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      padding:10px 12px;border-radius:14px;display:flex;gap:10px;align-items:center
    }
    .small{font-size:12px;color:var(--muted)}
    .filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .inp, .sel, .ta{
      width:100%;
      padding:12px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;outline:none
    }
    .sel{padding:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:820px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:var(--shadow);
      position:relative;
    }
    .imgWrap{position:relative}
    .img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;background:#222}
    .tagRow{position:absolute;left:10px;top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{
      font-size:11px;font-weight:900;letter-spacing:.4px;
      padding:6px 9px;border-radius:999px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(6px)
    }
    .tag-new{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.35)}
    .tag-sale{background:rgba(239,68,68,.16);border-color:rgba(239,68,68,.35)}
    .p{padding:12px}
    .name{margin:0 0 8px;font-weight:900;font-size:14px}
    .priceLine{display:flex;align-items:baseline;gap:8px;margin:0 0 10px}
    .priceNow{font-weight:900}
    .priceOld{color:var(--muted);text-decoration:line-through;font-size:12px}

    /* Overlay / drawer / modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.60);display:none;z-index:90}
    .overlay.show{display:block}
    .drawer{
      position:fixed;right:0;top:0;height:100%;width:min(420px,92vw);
      background:rgba(14,14,18,.92);backdrop-filter:blur(10px);
      border-left:1px solid rgba(255,255,255,.10);
      transform:translateX(110%);transition:.25s;
      z-index:95;display:flex;flex-direction:column
    }
    .drawer.open{transform:translateX(0)}
    .drawerHead{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px;border-bottom:1px solid rgba(255,255,255,.08)}
    .drawerHead h2{margin:0;font-size:18px}
    .xbtn{background:rgba(255,255,255,.08);border:0;color:#fff;width:38px;height:38px;border-radius:12px;cursor:pointer;font-size:18px}
    .cartlist{padding:10px 14px;overflow:auto;flex:1}
    .item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.06)}
    .thumb{width:56px;height:56px;border-radius:14px;object-fit:cover;background:#222}
    .itxt{flex:1}
    .itxt b{display:block;font-size:13px;margin-bottom:4px}
    .qty{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
    .qty button{
      width:34px;height:34px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);color:#fff;font-size:18px;cursor:pointer
    }
    .foot{padding:12px 14px;border-top:1px solid rgba(255,255,255,.08)}
    .foot .line{display:flex;justify-content:space-between;margin:8px 0;color:#ddd}
    .foot .line b{color:#fff}

    .modal{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(560px,92vw);
      background:rgba(16,16,20,.95);
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      z-index:100;display:none;box-shadow:var(--shadow)
    }
    .modal.show{display:block}
    .modalHead{
      padding:14px;border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .modalHead h3{margin:0;font-size:18px}
    .modalBody{padding:14px}
    .form{display:grid;gap:10px}
    .ta{min-height:90px;resize:vertical}
    .two{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    @media(max-width:520px){.two{grid-template-columns:1fr}}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:8px 0}

    .adminList{display:grid;gap:10px}
    .adminItem{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:16px;padding:10px;display:flex;gap:10px;align-items:center
    }
    .adminItem img{width:54px;height:54px;border-radius:14px;object-fit:cover;background:#222}
    .adminItem .meta{flex:1}
    .adminItem .meta b{display:block;font-size:13px;margin-bottom:3px}
    .adminItem .meta span{color:var(--muted);font-size:12px}
    .adminItem .actions{display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>

<body>
<header>
  <div class="headRow">
    <div class="brand">MertaX Butik</div>
    <div class="headBtns">
      <button class="btn btn-ghost" id="adminBtn">Admin</button>
      <button class="btn" id="openCartBtn">–ö–æ—à–Ω–∏—á–∫–∞</button>
      <button class="btn btn-danger" id="clearCartBtn">–ò—Å–ø—Ä–∞–∑–Ω–∏</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="topbar">
    <div class="badge">
      üõí <span>–ö–æ—à–Ω–∏—á–∫–∞:</span> <b id="cartCount">0</b>
      <span class="small">| –í–∫—É–ø–Ω–æ: <b id="cartTotal">0</b> –¥–µ–Ω.</span>
    </div>

    <div class="filters" style="flex:1; justify-content:flex-end;">
      <input class="inp" id="searchInp" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò (–ø—Ä–∏–º–µ—Ä: –º–∞–∏—á–∫–∞, –ø–∞—Ç–∏–∫–∏...)" style="max-width:320px;">
      <select class="sel" id="catSel" style="max-width:210px;">
        <option value="ALL">–°–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
      </select>
    </div>

    <div class="small">WhatsApp: <b>+38972912601</b> ‚Ä¢ –õ–æ–∫–∞—Ü–∏—ò–∞: <b>–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞</b></div>
  </div>

  <div class="grid" id="productGrid"></div>
</div>

<div class="overlay" id="overlay"></div>

<!-- Cart drawer -->
<aside class="drawer" id="drawer">
  <div class="drawerHead">
    <h2>–¢–≤–æ—ò–∞ –∫–æ—à–Ω–∏—á–∫–∞</h2>
    <button class="xbtn" id="closeCartBtn">‚úï</button>
  </div>
  <div class="cartlist" id="cartList"></div>
  <div class="foot">
    <div class="line"><span>–ü—Ä–æ–∏–∑–≤–æ–¥–∏</span> <b id="sumItems">0</b></div>
    <div class="line"><span>–í–∫—É–ø–Ω–æ</span> <b><span id="sumTotal">0</span> –¥–µ–Ω.</b></div>
    <button class="btn btn-accent" id="goCheckoutBtn" style="width:100%;">–ü—Ä–æ–¥–æ–ª–∂–∏ –Ω–∞ –Ω–∞—Ä–∞—á–∫–∞</button>
  </div>
</aside>

<!-- Checkout modal -->
<div class="modal" id="checkoutModal">
  <div class="modalHead">
    <h3>–ù–∞—Ä–∞—á–∫–∞</h3>
    <button class="xbtn" id="closeCheckoutBtn">‚úï</button>
  </div>
  <div class="modalBody">
    <div class="small">–ë—Ä–æ—ò –Ω–∞ –Ω–∞—Ä–∞—á–∫–∞: <b id="orderIdText">-</b></div>
    <div class="hr"></div>
    <div class="form">
      <input class="inp" id="custName" placeholder="–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ" />
      <input class="inp" id="custPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–ø—Ä–∏–º–µ—Ä: 07X XXX XXX)" />
      <textarea class="ta" id="custNote" placeholder="–ù–∞–ø–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)"></textarea>
      <div class="small">–õ–æ–∫–∞—Ü–∏—ò–∞ –∑–∞ –ø–æ–¥–∏–≥–∞—ö–µ: <b>–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞</b>. –å–µ —Å–µ –æ—Ç–≤–æ—Ä–∏ WhatsApp —Å–æ –≥–æ—Ç–æ–≤–∞ –ø–æ—Ä–∞–∫–∞.</div>
      <button class="btn btn-accent" id="sendWhatsappBtn">–ò—Å–ø—Ä–∞—Ç–∏ –Ω–∞ WhatsApp</button>
    </div>
  </div>
</div>

<!-- Admin modal -->
<div class="modal" id="adminModal">
  <div class="modalHead">
    <h3>Admin –ø–∞–Ω–µ–ª</h3>
    <button class="xbtn" id="closeAdminBtn">‚úï</button>
  </div>
  <div class="modalBody">
    <div id="adminLocked">
      <input class="inp" id="adminPin" placeholder="–í–Ω–µ—Å–∏ PIN" type="password" />
      <button class="btn btn-accent" id="unlockAdminBtn" style="width:100%;">–û—Ç–∫–ª—É—á–∏</button>
      <div class="small">–û–≤–∞ –µ ‚Äú–ª–µ—Å–µ–Ω‚Äù admin (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä) ‚Äì —Ä–∞–±–æ—Ç–∏ –ø—Ä–µ–∫—É browser storage.</div>
    </div>

    <div id="adminUnlocked" style="display:none;">
      <div class="small">–î–æ–¥–∞—ò/–∏–∑–º–µ–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏. –°–µ –∑–∞—á—É–≤—É–≤–∞–∞—Ç –ª–æ–∫–∞–ª–Ω–æ (localStorage).</div>
      <div class="hr"></div>

      <div class="form">
        <div class="two">
          <input class="inp" id="pName" placeholder="–ò–º–µ (–ø—Ä–∏–º–µ—Ä: MertaX –ú–∞–∏—á–∫–∞)" />
          <input class="inp" id="pImg" placeholder="–°–ª–∏–∫–∞ URL (https://...)" />
        </div>
        <div class="two">
          <input class="inp" id="pPrice" placeholder="–ù–æ–≤–∞ —Ü–µ–Ω–∞ (–¥–µ–Ω.)" inputmode="numeric" />
          <input class="inp" id="pOldPrice" placeholder="–°—Ç–∞—Ä–∞ —Ü–µ–Ω–∞ (–¥–µ–Ω.) - –æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ" inputmode="numeric" />
        </div>
        <div class="two">
          <select class="sel" id="pBadge">
            <option value="">–ë–µ–∑ –æ–∑–Ω–∞–∫–∞</option>
            <option value="–ù–û–í–û">–ù–û–í–û</option>
            <option value="–ê–ö–¶–ò–à–ê">–ê–ö–¶–ò–à–ê</option>
          </select>
          <select class="sel" id="pCat">
            <option value="–ê–∫—Å–µ—Å–æ–∞—Ä–∏">–ê–∫—Å–µ—Å–æ–∞—Ä–∏</option>
            <option value="–û–±–ª–µ–∫–∞">–û–±–ª–µ–∫–∞</option>
            <option value="–ü–∞—Ç–∏–∫–∏">–ü–∞—Ç–∏–∫–∏</option>
          </select>
        </div>
        <div class="two">
          <input class="inp" id="pId" placeholder="ID (–æ—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ –∑–∞ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏)" />
          <button class="btn btn-accent" id="saveProductBtn">–ó–∞—á—É–≤–∞—ò (–¥–æ–¥–∞—ò/–∏–∑–º–µ–Ω–∏)</button>
        </div>
        <button class="btn btn-ghost" id="resetDefaultsBtn">–í—Ä–∞—Ç–∏ default –ø—Ä–æ–∏–∑–≤–æ–¥–∏</button>
      </div>

      <div class="hr"></div>
      <div class="adminList" id="adminList"></div>
    </div>
  </div>
</div>

<script>
  // ‚úÖ –ù–∞–º–µ—Å—Ç–µ–Ω–æ
  const WHATSAPP_NUMBER = "38972912601";
  const STORE_LOCATION = "–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞";
  const ADMIN_PIN = "1234"; // —Å–º–µ–Ω–∏ –∞–∫–æ —Å–∞–∫–∞—à

  const CART_KEY = "mertax_cart_pro";
  const PRODUCTS_KEY = "mertax_products_pro";

  const defaultProducts = [
    { id:"p1", name:"MertaX –ü–∞—Ä–∏—á–Ω–∏–∫", price:790, oldPrice:990, badge:"–ê–ö–¶–ò–à–ê", cat:"–ê–∫—Å–µ—Å–æ–∞—Ä–∏", img:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=900&q=60" },
    { id:"p2", name:"MertaX –ú–∞–∏—á–∫–∞",  price:990, oldPrice:null, badge:"–ù–û–í–û",   cat:"–û–±–ª–µ–∫–∞",   img:"https://images.unsplash.com/photo-1523381294911-8d3cead13475?auto=format&fit=crop&w=900&q=60" },
    { id:"p3", name:"MertaX –ö–∞–ø—á–µ",   price:590, oldPrice:790, badge:"–ê–ö–¶–ò–à–ê", cat:"–ê–∫—Å–µ—Å–æ–∞—Ä–∏", img:"https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?auto=format&fit=crop&w=900&q=60" },
    { id:"p4", name:"MertaX –ü–∞—Ç–∏–∫–∏",  price:2990, oldPrice:null, badge:"",     cat:"–ü–∞—Ç–∏–∫–∏",   img:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=900&q=60" },
  ];

  const loadProducts = () => {
    try{
      const saved = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || "null");
      if(Array.isArray(saved) && saved.length) return saved;
    }catch(e){}
    return defaultProducts.slice();
  };
  const saveProducts = (arr) => localStorage.setItem(PRODUCTS_KEY, JSON.stringify(arr));

  const loadCart = () => JSON.parse(localStorage.getItem(CART_KEY) || "[]");
  const saveCart = (cart) => localStorage.setItem(CART_KEY, JSON.stringify(cart));

  let products = loadProducts();
  let currentOrderId = null;

  const findProduct = (id) => products.find(p => p.id === id);

  function cartTotals(cart){
    let items = 0, total = 0;
    for(const c of cart){
      items += c.qty;
      const p = findProduct(c.id);
      if(p) total += p.price * c.qty;
    }
    return { items, total };
  }

  function addToCart(id){
    const cart = loadCart();
    const item = cart.find(x => x.id === id);
    if(item) item.qty += 1;
    else cart.push({ id, qty:1 });
    saveCart(cart);
    renderCartUI();
  }

  function setQty(id, qty){
    const cart = loadCart().map(x => x.id === id ? ({...x, qty}) : x).filter(x => x.qty > 0);
    saveCart(cart);
    renderCartUI();
  }

  function clearCart(){ saveCart([]); renderCartUI(); }

  // ---- Search + Category filter
  const searchInp = document.getElementById("searchInp");
  const catSel = document.getElementById("catSel");

  function uniqueCats(){
    const set = new Set(products.map(p => (p.cat || "–î—Ä—É–≥–æ")));
    return ["ALL", ...Array.from(set)];
  }
  function renderCats(){
    const cats = uniqueCats();
    catSel.innerHTML = cats.map(c => `<option value="${c}">${c==="ALL" ? "–°–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" : c}</option>`).join("");
  }

  function filteredProducts(){
    const q = (searchInp.value || "").trim().toLowerCase();
    const cat = catSel.value || "ALL";
    return products.filter(p => {
      const okQ = !q || (p.name || "").toLowerCase().includes(q);
      const okC = (cat === "ALL") || ((p.cat || "–î—Ä—É–≥–æ") === cat);
      return okQ && okC;
    });
  }

  // ---- Render products
  const grid = document.getElementById("productGrid");
  function renderProducts(){
    const list = filteredProducts();
    grid.innerHTML = list.map(p => {
      const old = (p.oldPrice !== null && p.oldPrice !== "" && !isNaN(Number(p.oldPrice))) ? Number(p.oldPrice) : null;
      const badge = (p.badge || "").trim();
      const pct = (old && old > p.price) ? Math.round(((old - p.price)/old)*100) : null;

      return `
        <div class="card">
          <div class="imgWrap">
            <img class="img" src="${p.img}" alt="${p.name}">
            <div class="tagRow">
              ${badge ? `<span class="tag ${badge==="–ù–û–í–û" ? "tag-new" : "tag-sale"}">${badge}</span>` : ""}
              ${pct ? `<span class="tag tag-sale">-${pct}%</span>` : ""}
              ${p.cat ? `<span class="tag">${p.cat}</span>` : ""}
            </div>
          </div>
          <div class="p">
            <p class="name">${p.name}</p>
            <div class="priceLine">
              <span class="priceNow">${p.price} –¥–µ–Ω.</span>
              ${old && old > p.price ? `<span class="priceOld">${old} –¥–µ–Ω.</span>` : ""}
            </div>
            <div class="row">
              <button class="btn btn-accent" onclick="addToCart('${p.id}')">–î–æ–¥–∞—ò</button>
              <span class="small">ID: ${p.id}</span>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  // ---- Cart UI
  const cartCount = document.getElementById("cartCount");
  const cartTotal = document.getElementById("cartTotal");
  const cartList = document.getElementById("cartList");
  const sumItems = document.getElementById("sumItems");
  const sumTotal = document.getElementById("sumTotal");

  const overlay = document.getElementById("overlay");
  const drawer = document.getElementById("drawer");

  function openCart(){ overlay.classList.add("show"); drawer.classList.add("open"); }
  function closeCart(){ drawer.classList.remove("open"); if(!checkoutModal.classList.contains("show") && !adminModal.classList.contains("show")) overlay.classList.remove("show"); }

  function renderCartUI(){
    const cart = loadCart();
    const { items, total } = cartTotals(cart);

    cartCount.textContent = items;
    cartTotal.textContent = total;
    sumItems.textContent = items;
    sumTotal.textContent = total;

    if(cart.length === 0){
      cartList.innerHTML = `<p class="small">–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</p>`;
      return;
    }

    cartList.innerHTML = cart.map(c => {
      const p = findProduct(c.id);
      if(!p) return "";
      return `
        <div class="item">
          <img class="thumb" src="${p.img}" alt="${p.name}">
          <div class="itxt">
            <b>${p.name}</b>
            <div class="small">${p.price} –¥–µ–Ω. √ó ${c.qty} = <b>${p.price*c.qty}</b> –¥–µ–Ω.</div>
            <div class="qty" style="margin-top:8px;">
              <button onclick="setQty('${c.id}', ${c.qty-1})">‚àí</button>
              <span style="min-width:22px; text-align:center;">${c.qty}</span>
              <button onclick="setQty('${c.id}', ${c.qty+1})">+</button>
              <button class="btn btn-danger" style="margin-left:auto; padding:8px 10px; border-radius:12px;" onclick="setQty('${c.id}', 0)">–û—Ç—Å—Ç—Ä–∞–Ω–∏</button>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  // ---- Checkout + Order ID
  const checkoutModal = document.getElementById("checkoutModal");
  const orderIdText = document.getElementById("orderIdText");

  function makeOrderId(){
    const d = new Date();
    const pad = (n)=> String(n).padStart(2,"0");
    const base = `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
    const rnd = Math.random().toString(16).slice(2,6).toUpperCase();
    return `MX-${base}-${rnd}`;
  }

  function openCheckout(){
    const cart = loadCart();
    if(cart.length === 0){ alert("–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞."); return; }
    currentOrderId = makeOrderId();
    orderIdText.textContent = currentOrderId;
    checkoutModal.classList.add("show");
    overlay.classList.add("show");
  }
  function closeCheckout(){
    checkoutModal.classList.remove("show");
    if(!drawer.classList.contains("open") && !adminModal.classList.contains("show")) overlay.classList.remove("show");
  }

  function buildOrderText(){
    const name = (document.getElementById("custName").value || "").trim();
    const phone = (document.getElementById("custPhone").value || "").trim();
    const note = (document.getElementById("custNote").value || "").trim();

    const cart = loadCart();
    const { items, total } = cartTotals(cart);

    let lines = [];
    lines.push("üõçÔ∏è –ù–∞—Ä–∞—á–∫–∞ - MertaX");
    lines.push("üßæ –ë—Ä–æ—ò: " + (currentOrderId || "-"));
    lines.push("üìç –õ–æ–∫–∞—Ü–∏—ò–∞: " + STORE_LOCATION);
    lines.push("");
    lines.push("üë§ –ò–º–µ: " + (name || "-"));
    lines.push("üìû –¢–µ–ª–µ—Ñ–æ–Ω: " + (phone || "-"));
    if(note) lines.push("üìù –ù–∞–ø–æ–º–µ–Ω–∞: " + note);
    lines.push("");
    lines.push("üì¶ –ü—Ä–æ–∏–∑–≤–æ–¥–∏:");
    cart.forEach(c=>{
      const p = findProduct(c.id);
      if(p) lines.push(`- ${p.name} x${c.qty} = ${p.price*c.qty} –¥–µ–Ω.`);
    });
    lines.push("");
    lines.push(`‚úÖ –í–∫—É–ø–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏: ${items}`);
    lines.push(`üí∞ –í–∫—É–ø–Ω–æ: ${total} –¥–µ–Ω.`);
    return lines.join("\n");
  }

  function sendToWhatsApp(){
    const url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(buildOrderText());
    window.open(url, "_blank");
  }

  // ---- Admin
  const adminModal = document.getElementById("adminModal");
  const adminLocked = document.getElementById("adminLocked");
  const adminUnlocked = document.getElementById("adminUnlocked");
  const adminPin = document.getElementById("adminPin");
  const adminList = document.getElementById("adminList");

  const pName = document.getElementById("pName");
  const pImg = document.getElementById("pImg");
  const pPrice = document.getElementById("pPrice");
  const pOldPrice = document.getElementById("pOldPrice");
  const pBadge = document.getElementById("pBadge");
  const pCat = document.getElementById("pCat");
  const pId = document.getElementById("pId");

  function openAdmin(){ adminModal.classList.add("show"); overlay.classList.add("show"); }
  function closeAdmin(){ adminModal.classList.remove("show"); if(!drawer.classList.contains("open") && !checkoutModal.classList.contains("show")) overlay.classList.remove("show"); }
  function setAdminUnlocked(ok){
    adminLocked.style.display = ok ? "none" : "block";
    adminUnlocked.style.display = ok ? "block" : "none";
  }

  function adminRenderList(){
    adminList.innerHTML = products.map(p => `
      <div class="adminItem">
        <img src="${p.img}" alt="">
        <div class="meta">
          <b>${p.name}</b>
          <span>ID: ${p.id} ‚Ä¢ ${p.price} –¥–µ–Ω.${p.oldPrice ? ` ‚Ä¢ —Å—Ç–∞—Ä–æ: ${p.oldPrice}` : ""} ${p.badge ? ` ‚Ä¢ ${p.badge}` : ""} ${p.cat ? ` ‚Ä¢ ${p.cat}` : ""}</span>
        </div>
        <div class="actions">
          <button class="btn" onclick="adminEdit('${p.id}')">–ò–∑–º–µ–Ω–∏</button>
          <button class="btn btn-danger" onclick="adminDelete('${p.id}')">–ò–∑–±—Ä–∏—à–∏</button>
        </div>
      </div>
    `).join("");
  }

  window.adminEdit = (id) => {
    const p = findProduct(id); if(!p) return;
    pName.value = p.name || "";
    pImg.value = p.img || "";
    pPrice.value = String(p.price ?? "");
    pOldPrice.value = p.oldPrice ? String(p.oldPrice) : "";
    pBadge.value = p.badge || "";
    pCat.value = p.cat || "–ê–∫—Å–µ—Å–æ–∞—Ä–∏";
    pId.value = p.id || "";
  };

  window.adminDelete = (id) => {
    if(!confirm("–î–∞ –∏–∑–±—Ä–∏—à–∞–º –ø—Ä–æ–∏–∑–≤–æ–¥?")) return;
    products = products.filter(x => x.id !== id);
    saveProducts(products);
    renderCats();
    renderProducts();
    renderCartUI();
    adminRenderList();
  };

  function upsertProduct(){
    const name = (pName.value||"").trim();
    const img = (pImg.value||"").trim();
    const price = Number((pPrice.value||"").trim());
    const oldRaw = (pOldPrice.value||"").trim();
    const oldPrice = oldRaw ? Number(oldRaw) : null;
    const badge = (pBadge.value||"").trim();
    const cat = (pCat.value||"").trim();
    let id = (pId.value||"").trim();

    if(!name || !img || !Number.isFinite(price)){ alert("–í–Ω–µ—Å–∏: –∏–º–µ, —Å–ª–∏–∫–∞ URL –∏ –Ω–æ–≤–∞ —Ü–µ–Ω–∞."); return; }
    if(!id) id = "p" + Math.random().toString(16).slice(2,6);

    const next = { id, name, img, price, oldPrice: (Number.isFinite(oldPrice) ? oldPrice : null), badge, cat };
    const idx = products.findIndex(x => x.id === id);
    if(idx >= 0) products[idx] = next; else products.unshift(next);

    saveProducts(products);
    renderCats();
    renderProducts();
    renderCartUI();
    adminRenderList();

    pName.value=""; pImg.value=""; pPrice.value=""; pOldPrice.value=""; pBadge.value=""; pCat.value="–ê–∫—Å–µ—Å–æ–∞—Ä–∏"; pId.value="";
    alert("–ó–∞—á—É–≤–∞–Ω–æ ‚úÖ");
  }

  function resetDefaults(){
    if(!confirm("–î–∞ –≥–∏ –≤—Ä–∞—Ç–∞–º default –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ?")) return;
    products = defaultProducts.slice();
    saveProducts(products);
    renderCats();
    renderProducts();
    renderCartUI();
    adminRenderList();
  }

  // --- Events
  document.getElementById("openCartBtn").addEventListener("click", openCart);
  document.getElementById("closeCartBtn").addEventListener("click", closeCart);
  document.getElementById("clearCartBtn").addEventListener("click", clearCart);

  document.getElementById("goCheckoutBtn").addEventListener("click", openCheckout);
  document.getElementById("closeCheckoutBtn").addEventListener("click", closeCheckout);
  document.getElementById("sendWhatsappBtn").addEventListener("click", sendToWhatsApp);

  document.getElementById("adminBtn").addEventListener("click", openAdmin);
  document.getElementById("closeAdminBtn").addEventListener("click", closeAdmin);

  document.getElementById("unlockAdminBtn").addEventListener("click", () => {
    if((adminPin.value||"").trim() === ADMIN_PIN){
      setAdminUnlocked(true);
      adminPin.value="";
      adminRenderList();
    } else alert("–ü–æ–≥—Ä–µ—à–µ–Ω PIN");
  });

  document.getElementById("saveProductBtn").addEventListener("click", upsertProduct);
  document.getElementById("resetDefaultsBtn").addEventListener("click", resetDefaults);

  overlay.addEventListener("click", () => { closeCheckout(); closeAdmin(); closeCart(); });

  searchInp.addEventListener("input", renderProducts);
  catSel.addEventListener("change", renderProducts);

  // expose for inline
  window.addToCart = addToCart;
  window.setQty = setQty;

  // Init
  function init(){
    renderCats();
    renderProducts();
    renderCartUI();
    setAdminUnlocked(false);
  }
  init();
</script>
</body>
</html>

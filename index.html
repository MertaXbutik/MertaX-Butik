<!doctype html>
<html lang="mk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MertaX Butik</title>
  <style>
    :root { --card:#121212; --muted:#bdbdbd; --txt:#fff; --accent:#22c55e; --danger:#ef4444; --bg:#0f0f10; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:Arial, sans-serif; background:var(--bg); color:var(--txt); }
    header{ background:#000; color:#fff; padding:16px 14px; text-align:center; font-size:22px; letter-spacing:1px; position:sticky; top:0; z-index:5; }

    .wrap{ max-width:1100px; margin:0 auto; padding:14px; }
    .topbar{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin:10px 0 14px; flex-wrap:wrap; }
    .badge{ background:#1f1f1f; padding:10px 12px; border-radius:14px; color:#fff; display:flex; align-items:center; gap:10px; }
    .btn{ border:0; cursor:pointer; padding:12px 14px; border-radius:14px; font-weight:700; }
    .btn-accent{ background:var(--accent); color:#041a0b; }
    .btn-danger{ background:var(--danger); color:#fff; }
    .btn-dark{ background:#1f1f1f; color:#fff; }

    .grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }
    @media (min-width:820px){ .grid{ grid-template-columns:repeat(4,1fr); } }

    .card{ background:var(--card); border-radius:18px; overflow:hidden; border:1px solid #1f1f1f; }
    .img{ width:100%; aspect-ratio: 1/1; object-fit:cover; background:#222; display:block; }
    .p{ padding:12px; }
    .name{ font-weight:800; margin:0 0 6px; font-size:14px; }
    .price{ color:var(--muted); margin:0 0 10px; font-size:13px; }
    .row{ display:flex; gap:8px; align-items:center; justify-content:space-between; }
    .small{ font-size:12px; color:var(--muted); }

    /* Drawer / modal basics */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; z-index:9; }
    .overlay.show{ display:block; }

    .drawer{ position:fixed; right:0; top:0; height:100%; width:min(420px, 92vw); background:#0e0e0f; border-left:1px solid #1f1f1f;
      transform:translateX(110%); transition:.25s; z-index:10; display:flex; flex-direction:column; }
    .drawer.open{ transform:translateX(0); }
    .drawer h2{ margin:0; padding:14px; border-bottom:1px solid #1f1f1f; font-size:18px; }

    .cartlist{ padding:10px 14px; overflow:auto; flex:1; }
    .item{ display:flex; gap:10px; padding:10px 0; border-bottom:1px solid #1a1a1a; }
    .thumb{ width:56px; height:56px; border-radius:12px; object-fit:cover; background:#222; }
    .itxt{ flex:1; }
    .itxt b{ display:block; font-size:13px; margin-bottom:4px; }
    .qty{ display:flex; gap:6px; align-items:center; }
    .qty button{ width:34px; height:34px; border-radius:12px; border:1px solid #2a2a2a; background:#151515; color:#fff; font-size:18px; cursor:pointer; }

    .foot{ padding:12px 14px; border-top:1px solid #1f1f1f; }
    .foot .line{ display:flex; justify-content:space-between; margin:8px 0; color:#ddd; }
    .foot .line b{ color:#fff; }

    /* Checkout modal */
    .modal{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      width:min(520px, 92vw); background:#101012; border:1px solid #232323;
      border-radius:18px; z-index:11; display:none;
    }
    .modal.show{ display:block; }
    .modalHead{ padding:14px; border-bottom:1px solid #1f1f1f; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .modalHead h3{ margin:0; font-size:18px; }
    .xbtn{ background:#1f1f1f; border:0; color:#fff; width:38px; height:38px; border-radius:12px; cursor:pointer; font-size:18px; }
    .modalBody{ padding:14px; }
    .form{ display:grid; gap:10px; }
    .inp, .ta{
      width:100%; padding:12px 12px; border-radius:14px; border:1px solid #2a2a2a;
      background:#0b0b0c; color:#fff; outline:none;
    }
    .ta{ min-height:90px; resize:vertical; }
    .hint{ color:var(--muted); font-size:12px; margin-top:-4px; }
  </style>
</head>

<body>
  <header>MertaX Butik</header>

  <div class="wrap">
    <div class="topbar">
      <div class="badge">
        üõí –ö–æ—à–Ω–∏—á–∫–∞: <b id="cartCount">0</b>
        <span class="small">| –í–∫—É–ø–Ω–æ: <b id="cartTotal">0</b> –¥–µ–Ω.</span>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn btn-dark" id="openCartBtn">–û—Ç–≤–æ—Ä–∏ –∫–æ—à–Ω–∏—á–∫–∞</button>
        <button class="btn btn-danger" id="clearCartBtn">–ò—Å–ø—Ä–∞–∑–Ω–∏</button>
      </div>
    </div>

    <div class="grid" id="productGrid"></div>
  </div>

  <!-- Overlays -->
  <div class="overlay" id="overlay"></div>

  <!-- Cart drawer -->
  <aside class="drawer" id="drawer">
    <h2>–¢–≤–æ—ò–∞ –∫–æ—à–Ω–∏—á–∫–∞</h2>
    <div class="cartlist" id="cartList"></div>
    <div class="foot">
      <div class="line"><span>–ü—Ä–æ–∏–∑–≤–æ–¥–∏</span> <b id="sumItems">0</b></div>
      <div class="line"><span>–í–∫—É–ø–Ω–æ</span> <b><span id="sumTotal">0</span> –¥–µ–Ω.</b></div>
      <button class="btn btn-accent" id="goCheckoutBtn" style="width:100%;">–ü—Ä–æ–¥–æ–ª–∂–∏ –Ω–∞ –Ω–∞—Ä–∞—á–∫–∞</button>
    </div>
  </aside>

  <!-- Checkout modal -->
  <div class="modal" id="checkoutModal" aria-hidden="true">
    <div class="modalHead">
      <h3>–ù–∞—Ä–∞—á–∫–∞</h3>
      <button class="xbtn" id="closeCheckoutBtn">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="form">
        <input class="inp" id="custName" placeholder="–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ" />
        <input class="inp" id="custPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–ø—Ä–∏–º–µ—Ä: 07X XXX XXX)" />
        <textarea class="ta" id="custNote" placeholder="–ù–∞–ø–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)"></textarea>

        <div class="hint">–õ–æ–∫–∞—Ü–∏—ò–∞ –∑–∞ –ø–æ–¥–∏–≥–∞—ö–µ: <b>–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞</b>. –°–æ ‚Äû–ò—Å–ø—Ä–∞—Ç–∏ –Ω–∞ WhatsApp‚Äú —ú–µ —Å–µ –æ—Ç–≤–æ—Ä–∏ WhatsApp —Å–æ –ø–æ–¥–≥–æ—Ç–≤–µ–Ω–∞ –ø–æ—Ä–∞–∫–∞.</div>
        <button class="btn btn-accent" id="sendWhatsappBtn">–ò—Å–ø—Ä–∞—Ç–∏ –Ω–∞ WhatsApp</button>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ –ù–∞–º–µ—Å—Ç–µ–Ω–æ: +38972912601 (–±–µ–∑ +)
    const WHATSAPP_NUMBER = "38972912601";
    const STORE_LOCATION = "–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞";

    // ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏ (–ö–∞–ø—á–µ—Ç–æ –µ –ø–æ–ø—Ä–∞–≤–µ–Ω–æ)
    const products = [
      { id:"p1", name:"MertaX –ü–∞—Ä–∏—á–Ω–∏–∫", price:790, img:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=900&q=60" },
      { id:"p2", name:"MertaX –ú–∞–∏—á–∫–∞", price:990, img:"https://images.unsplash.com/photo-1523381294911-8d3cead13475?auto=format&fit=crop&w=900&q=60" },
      { id:"p3", name:"MertaX –ö–∞–ø—á–µ",  price:590, img:"https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?auto=format&fit=crop&w=900&q=60" },
      { id:"p4", name:"MertaX –ü–∞—Ç–∏–∫–∏", price:2990, img:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=900&q=60" },
    ];

    // ----- CART STORAGE -----
    const CART_KEY = "mertax_cart_v1";
    const loadCart = () => JSON.parse(localStorage.getItem(CART_KEY) || "[]");
    const saveCart = (cart) => localStorage.setItem(CART_KEY, JSON.stringify(cart));
    const findProduct = (id) => products.find(p => p.id === id);

    function cartTotals(cart){
      let items = 0, total = 0;
      for(const c of cart){
        items += c.qty;
        const p = findProduct(c.id);
        if(p) total += p.price * c.qty;
      }
      return { items, total };
    }

    function addToCart(id){
      const cart = loadCart();
      const item = cart.find(x => x.id === id);
      if(item) item.qty += 1;
      else cart.push({ id, qty:1 });
      saveCart(cart);
      renderCartUI();
    }

    function setQty(id, qty){
      const cart = loadCart()
        .map(x => x.id === id ? ({...x, qty}) : x)
        .filter(x => x.qty > 0);
      saveCart(cart);
      renderCartUI();
    }

    function clearCart(){
      saveCart([]);
      renderCartUI();
    }

    // ----- RENDER PRODUCTS -----
    const grid = document.getElementById("productGrid");
    function renderProducts(){
      grid.innerHTML = products.map(p => `
        <div class="card">
          <img class="img" src="${p.img}" alt="${p.name}">
          <div class="p">
            <p class="name">${p.name}</p>
            <p class="price">${p.price} –¥–µ–Ω.</p>
            <div class="row">
              <button class="btn btn-accent" onclick="addToCart('${p.id}')">–î–æ–¥–∞—ò</button>
              <span class="small">ID: ${p.id}</span>
            </div>
          </div>
        </div>
      `).join("");
    }

    // ----- CART UI -----
    const cartCount = document.getElementById("cartCount");
    const cartTotal = document.getElementById("cartTotal");
    const cartList = document.getElementById("cartList");
    const sumItems = document.getElementById("sumItems");
    const sumTotal = document.getElementById("sumTotal");

    const overlay = document.getElementById("overlay");
    const drawer = document.getElementById("drawer");

    function openCart(){
      overlay.classList.add("show");
      drawer.classList.add("open");
    }
    function closeCart(){
      drawer.classList.remove("open");
      // overlay —ú–µ –≥–æ —Ç—Ä–≥–Ω–µ–º–µ —Å–∞–º–æ –∞–∫–æ –Ω–µ –µ –æ—Ç–≤–æ—Ä–µ–Ω checkout
      if(!checkoutModal.classList.contains("show")) overlay.classList.remove("show");
    }

    function renderCartUI(){
      const cart = loadCart();
      const { items, total } = cartTotals(cart);

      cartCount.textContent = items;
      cartTotal.textContent = total;
      sumItems.textContent = items;
      sumTotal.textContent = total;

      if(cart.length === 0){
        cartList.innerHTML = `<p class="small">–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</p>`;
        return;
      }

      cartList.innerHTML = cart.map(c => {
        const p = findProduct(c.id);
        if(!p) return "";
        return `
          <div class="item">
            <img class="thumb" src="${p.img}" alt="${p.name}">
            <div class="itxt">
              <b>${p.name}</b>
              <div class="small">${p.price} –¥–µ–Ω. √ó ${c.qty} = <b>${p.price*c.qty}</b> –¥–µ–Ω.</div>
              <div class="qty" style="margin-top:8px;">
                <button onclick="setQty('${c.id}', ${c.qty-1})">‚àí</button>
                <span style="min-width:22px; text-align:center;">${c.qty}</span>
                <button onclick="setQty('${c.id}', ${c.qty+1})">+</button>
                <button class="btn btn-danger" style="margin-left:auto; padding:8px 10px; border-radius:12px;"
                        onclick="setQty('${c.id}', 0)">–û—Ç—Å—Ç—Ä–∞–Ω–∏</button>
              </div>
            </div>
          </div>
        `;
      }).join("");
    }

    // ----- CHECKOUT -----
    const checkoutModal = document.getElementById("checkoutModal");
    const closeCheckoutBtn = document.getElementById("closeCheckoutBtn");
    const goCheckoutBtn = document.getElementById("goCheckoutBtn");
    const sendWhatsappBtn = document.getElementById("sendWhatsappBtn");

    function openCheckout(){
      const cart = loadCart();
      if(cart.length === 0){
        alert("–ö–æ—à–Ω–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.");
        return;
      }
      checkoutModal.classList.add("show");
      overlay.classList.add("show");
    }
    function closeCheckout(){
      checkoutModal.classList.remove("show");
      // overlay –æ—Å—Ç–∞–Ω—É–≤–∞ –∞–∫–æ drawer –µ –æ—Ç–≤–æ—Ä–µ–Ω
      if(!drawer.classList.contains("open")) overlay.classList.remove("show");
    }

    function buildOrderText(){
      const name = (document.getElementById("custName").value || "").trim();
      const phone = (document.getElementById("custPhone").value || "").trim();
      const note = (document.getElementById("custNote").value || "").trim();

      const cart = loadCart();
      const { items, total } = cartTotals(cart);

      let lines = [];
      lines.push("üõçÔ∏è –ù–∞—Ä–∞—á–∫–∞ - MertaX");
      lines.push("üìç –õ–æ–∫–∞—Ü–∏—ò–∞: " + STORE_LOCATION);
      lines.push("");
      lines.push("üë§ –ò–º–µ: " + (name || "-"));
      lines.push("üìû –¢–µ–ª–µ—Ñ–æ–Ω: " + (phone || "-"));
      if(note) lines.push("üìù –ù–∞–ø–æ–º–µ–Ω–∞: " + note);
      lines.push("");
      lines.push("üì¶ –ü—Ä–æ–∏–∑–≤–æ–¥–∏:");
      cart.forEach(c=>{
        const p = findProduct(c.id);
        if(p) lines.push(`- ${p.name} x${c.qty} = ${p.price*c.qty} –¥–µ–Ω.`);
      });
      lines.push("");
      lines.push(`‚úÖ –í–∫—É–ø–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏: ${items}`);
      lines.push(`üí∞ –í–∫—É–ø–Ω–æ: ${total} –¥–µ–Ω.`);
      return lines.join("\n");
    }

    function sendToWhatsApp(){
      const text = buildOrderText();
      const url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(text);
      window.open(url, "_blank");
    }

    // Expose for inline onclick
    window.addToCart = addToCart;
    window.setQty = setQty;

    // Buttons
    document.getElementById("openCartBtn").addEventListener("click", openCart);
    document.getElementById("clearCartBtn").addEventListener("click", clearCart);

    overlay.addEventListener("click", () => { closeCheckout(); closeCart(); });

    goCheckoutBtn.addEventListener("click", openCheckout);
    closeCheckoutBtn.addEventListener("click", closeCheckout);
    sendWhatsappBtn.addEventListener("click", sendToWhatsApp);

    // Init
    renderProducts();
    renderCartUI();
  </script>
</body>
</html>

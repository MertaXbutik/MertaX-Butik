<!doctype html>
<html lang="mk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MertaX Butik</title>

  <style>
    :root{
      --bg:#ffffff;
      --txt:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --chip:#f3f4f6;
      --card:#ffffff;
      --shadow:0 10px 26px rgba(0,0,0,.08);
      --radius:18px;
      --accent:#111827;    /* Zara-like: dark text accent */
      --accent2:#ef4444;   /* red */
      --good:#16a34a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;background:var(--bg);color:var(--txt)}
    a{color:inherit}
    header{
      position:sticky; top:0; z-index:50;
      background:#fff; border-bottom:1px solid var(--border);
    }
    .head{
      max-width:1100px; margin:0 auto; padding:14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .brand{font-size:22px;font-weight:900;letter-spacing:.6px}
    .headBtns{display:flex; gap:8px; align-items:center; flex-wrap:wrap}

    .btn{
      border:1px solid var(--border);
      background:#fff;
      color:var(--txt);
      padding:11px 14px;
      border-radius:999px;
      font-weight:800;
      cursor:pointer;
      transition:.15s;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:var(--shadow)}
    .btn-dark{background:var(--accent); color:#fff; border-color:transparent}
    .btn-red{background:var(--accent2); color:#fff; border-color:transparent}
    .btn-ghost{background:transparent}

    .wrap{max-width:1100px;margin:0 auto;padding:14px}

    /* Zara-like category tabs */
    .tabs{
      display:flex; gap:10px; overflow-x:auto; -webkit-overflow-scrolling:touch;
      padding:8px 2px 12px; margin:0;
    }
    .tabs::-webkit-scrollbar{height:6px}
    .tab{
      flex:0 0 auto;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      font-weight:900;
      letter-spacing:.2px;
      cursor:pointer;
      white-space:nowrap;
    }
    .tab.active{
      background:var(--accent);
      color:#fff;
      border-color:transparent;
    }

    /* Search row */
    .toolbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:6px 0 12px;
    }
    .searchBox{
      flex:1;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      min-width:260px;
    }
    .inp{
      width: min(520px, 100%);
      padding:12px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      outline:none;
      background:#fff;
      color:var(--txt);
    }
    .metaLine{font-size:12px;color:var(--muted);margin:10px 0 10px}
    .badge{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:10px 12px;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .small{font-size:12px;color:var(--muted)}

    /* Products grid */
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    @media(min-width:820px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:22px;
      overflow:hidden;
      box-shadow:var(--shadow);
      transition:.15s;
      position:relative;
    }
    .card:hover{transform:translateY(-3px)}
    .imgWrap{position:relative}
    .img{width:100%; aspect-ratio:1/1; object-fit:cover; display:block; background:#eee}
    .tagRow{position:absolute; left:10px; top:10px; display:flex; gap:8px; flex-wrap:wrap}
    .tag{
      font-size:11px; font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.85);
      border:1px solid var(--border);
      backdrop-filter: blur(6px);
    }
    .tag-new{background:#dcfce7;border-color:transparent;color:#166534}
    .tag-sale{background:#fee2e2;border-color:transparent;color:#991b1b}

    .p{padding:12px}
    .name{margin:0 0 6px;font-weight:900;font-size:14px}
    .sub{margin:0 0 10px; font-size:12px; color:var(--muted)}
    .priceLine{display:flex; align-items:baseline; gap:8px; flex-wrap:wrap; margin:0 0 10px}
    .priceNow{font-weight:900; font-size:16px}
    .priceOld{color:var(--muted); text-decoration:line-through; font-size:13px}
    .miniRow{display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .sel{
      border:1px solid var(--border);
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      font-weight:800;
      color:var(--txt);
      outline:none;
      min-width:150px;
    }

    .center{display:flex; justify-content:center; margin:14px 0}
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:90}
    .overlay.show{display:block}

    /* Cart drawer */
    .drawer{
      position:fixed; right:0; top:0; height:100%;
      width:min(420px,92vw);
      background:#fff;
      border-left:1px solid var(--border);
      transform:translateX(110%);
      transition:.22s;
      z-index:95;
      display:flex; flex-direction:column;
    }
    .drawer.open{transform:translateX(0)}
    .drawerHead{
      padding:14px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .drawerHead h2{margin:0;font-size:18px}
    .xbtn{
      width:40px; height:40px; border-radius:999px;
      background:var(--chip); border:1px solid var(--border);
      cursor:pointer; font-size:18px;
    }
    .cartlist{padding:10px 14px; overflow:auto; flex:1}
    .item{display:flex; gap:10px; padding:10px 0; border-bottom:1px solid var(--border)}
    .thumb{width:56px;height:56px;border-radius:14px;object-fit:cover;background:#eee}
    .itxt{flex:1}
    .itxt b{display:block;font-size:13px;margin-bottom:4px}
    .qty{display:flex; gap:6px; align-items:center; flex-wrap:wrap}
    .qty button{width:34px;height:34px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:18px;cursor:pointer}
    .foot{padding:12px 14px;border-top:1px solid var(--border)}
    .foot .line{display:flex;justify-content:space-between;margin:8px 0}

    /* FILTER drawer (Zara-like) */
    .filterDrawer{
      position:fixed; right:0; top:0; height:100%;
      width:min(420px,92vw);
      background:#fff;
      border-left:1px solid var(--border);
      transform:translateX(110%);
      transition:.22s;
      z-index:96;
      display:flex; flex-direction:column;
    }
    .filterDrawer.open{transform:translateX(0)}
    .section{padding:14px; border-bottom:1px solid var(--border)}
    .secTitle{font-weight:900; margin:0 0 10px}
    .row{display:grid; gap:10px}
    .two{display:grid; gap:10px; grid-template-columns:1fr 1fr}
    @media(max-width:520px){.two{grid-template-columns:1fr}}

    /* Modal (Admin + Checkout) */
    .modal{
      position:fixed; left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:min(860px,92vw);
      background:#fff; border:1px solid var(--border);
      border-radius:22px; z-index:100;
      display:none; box-shadow:var(--shadow);
    }
    .modal.show{display:block}
    .modalHead{
      padding:14px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:10px
    }
    .modalHead h3{margin:0;font-size:18px}
    .modalBody{padding:14px; max-height:72vh; overflow:auto}
    .ta{width:100%;padding:12px 14px;border-radius:14px;border:1px solid var(--border);background:#fff;outline:none;min-height:90px;resize:vertical}
    .hr{height:1px;background:var(--border);margin:10px 0}
    .pill{font-size:11px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:var(--chip)}
  </style>
</head>

<body>
<header>
  <div class="head">
    <div class="brand">MertaX Butik</div>
    <div class="headBtns">
      <button class="btn btn-ghost" id="adminBtn">Admin</button>
      <button class="btn" id="openCartBtn">–ö–æ—à–Ω–∏—á–∫–∞</button>
      <button class="btn btn-red" id="clearCartBtn">–ò—Å–ø—Ä–∞–∑–Ω–∏</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="tabs" id="tabs"></div>

  <div class="toolbar">
    <div class="searchBox">
      <input class="inp" id="searchInp" placeholder="Search (–∏–º–µ, –±—Ä–µ–Ω–¥, –±–æ—ò–∞)..." />
      <button class="btn btn-dark" id="openFilterBtn">FILTER</button>
      <select class="btn" id="sortSel" style="padding:11px 14px;">
        <option value="default">–°—Ç–∞–Ω–¥–∞—Ä–¥–Ω–æ</option>
        <option value="price_asc">–¶–µ–Ω–∞ ‚Üë</option>
        <option value="price_desc">–¶–µ–Ω–∞ ‚Üì</option>
        <option value="new_first">–ù–û–í–û –ø—Ä–≤–æ</option>
        <option value="sale_first">–ê–ö–¶–ò–à–ê –ø—Ä–≤–æ</option>
        <option value="name_asc">–ò–º–µ A‚ÜíZ</option>
      </select>
    </div>

    <div class="badge">
      üõí <span>–ö–æ—à–Ω–∏—á–∫–∞:</span> <b id="cartCount">0</b>
      <span class="small">| –í–∫—É–ø–Ω–æ: <b id="cartTotal">0</b> –¥–µ–Ω.</span>
    </div>
  </div>

  <div class="metaLine">
    WhatsApp: <b>+38972912601</b> ‚Ä¢ –õ–æ–∫–∞—Ü–∏—ò–∞: <b>–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞</b>
  </div>

  <div class="small" id="infoLine"></div>
  <div class="grid" id="productGrid"></div>

  <div class="center">
    <button class="btn btn-ghost" id="loadMoreBtn" style="display:none;">–í—á–∏—Ç–∞—ò —É—à—Ç–µ</button>
  </div>
</div>

<div class="overlay" id="overlay"></div>

<!-- Cart drawer -->
<aside class="drawer" id="drawer">
  <div class="drawerHead">
    <h2>–ö–æ—à–Ω–∏—á–∫–∞</h2>
    <button class="xbtn" id="closeCartBtn">‚úï</button>
  </div>
  <div class="cartlist" id="cartList"></div>
  <div class="foot">
    <div class="line"><span>–ü—Ä–æ–∏–∑–≤–æ–¥–∏</span> <b id="sumItems">0</b></div>
    <div class="line"><span>–î–æ—Å—Ç–∞–≤–∞</span> <b id="shipLine">0 –¥–µ–Ω.</b></div>
    <div class="line"><span>–í–∫—É–ø–Ω–æ</span> <b><span id="sumTotal">0</span> –¥–µ–Ω.</b></div>
    <button class="btn btn-dark" id="goCheckoutBtn" style="width:100%;">–ù–∞—Ä–∞—á–∞—ò</button>
  </div>
</aside>

<!-- FILTER drawer -->
<aside class="filterDrawer" id="filterDrawer">
  <div class="drawerHead">
    <h2>FILTER</h2>
    <button class="xbtn" id="closeFilterBtn">‚úï</button>
  </div>

  <div class="section">
    <p class="secTitle">–í–µ–ª–∏—á–∏–Ω–∞</p>
    <select class="sel" id="sizeFilterSel"></select>
  </div>

  <div class="section">
    <p class="secTitle">–ë—Ä–µ–Ω–¥ / –ú–∞—Ä–∫–∞</p>
    <input class="inp" id="brandFilterInp" placeholder="–ø—Ä–∏–º–µ—Ä: Zara, Nike..." />
  </div>

  <div class="section">
    <p class="secTitle">–ë–æ—ò–∞</p>
    <input class="inp" id="colorFilterInp" placeholder="–ø—Ä–∏–º–µ—Ä: black, white, blue..." />
  </div>

  <div class="section">
    <p class="secTitle">–¶–µ–Ω–∞</p>
    <div class="two">
      <input class="inp" id="minPriceInp" inputmode="numeric" placeholder="–æ–¥" />
      <input class="inp" id="maxPriceInp" inputmode="numeric" placeholder="–¥–æ" />
    </div>
  </div>

  <div class="section">
    <p class="secTitle">–û–∑–Ω–∞–∫–∏</p>
    <select class="sel" id="badgeFilterSel">
      <option value="ALL">–°–∏—Ç–µ</option>
      <option value="–ù–û–í–û">–ù–û–í–û</option>
      <option value="–ê–ö–¶–ò–à–ê">–ê–ö–¶–ò–à–ê</option>
      <option value="NONE">–ë–µ–∑ –æ–∑–Ω–∞–∫–∞</option>
    </select>
  </div>

  <div class="section" style="display:flex; gap:10px;">
    <button class="btn btn-ghost" id="clearFiltersBtn" style="flex:1;">Clear</button>
    <button class="btn btn-dark" id="applyFiltersBtn" style="flex:1;">Apply</button>
  </div>

  <div class="section small">
    Tip: Search –≥–æ—Ä–µ –ø—Ä–µ–±–∞—Ä—É–≤–∞ –∏ –ø–æ –∏–º–µ –∏ –ø–æ –±—Ä–µ–Ω–¥ –∏ –ø–æ –±–æ—ò–∞.
  </div>
</aside>

<!-- Checkout modal -->
<div class="modal" id="checkoutModal">
  <div class="modalHead">
    <h3>–ù–∞—Ä–∞—á–∫–∞</h3>
    <button class="xbtn" id="closeCheckoutBtn">‚úï</button>
  </div>
  <div class="modalBody">
    <div class="small">–ë—Ä–æ—ò –Ω–∞ –Ω–∞—Ä–∞—á–∫–∞: <b id="orderIdText">-</b></div>
    <div class="hr"></div>

    <div class="row">
      <input class="inp" id="custName" placeholder="–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ" />
      <input class="inp" id="custPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–ø—Ä–∏–º–µ—Ä: 07X XXX XXX)" />

      <div class="two">
        <select class="sel" id="paymentSel">
          <option value="–ì–æ—Ç–æ–≤–æ –ø—Ä–∏ –ø—Ä–∏–µ–º">–ì–æ—Ç–æ–≤–æ –ø—Ä–∏ –ø—Ä–∏–µ–º</option>
        </select>
        <select class="sel" id="exchangeSel">
          <option value="–î–∞">–ú–æ–∂–Ω–æ—Å—Ç –∑–∞ –∑–∞–º–µ–Ω–∞: –î–∞</option>
          <option value="–ù–µ">–ú–æ–∂–Ω–æ—Å—Ç –∑–∞ –∑–∞–º–µ–Ω–∞: –ù–µ</option>
        </select>
      </div>

      <div class="two">
        <select class="sel" id="deliverySel">
          <option value="–î–∞">–î–æ—Å—Ç–∞–≤–∞: –î–∞ (+150 –¥–µ–Ω)</option>
          <option value="–ù–µ">–î–æ—Å—Ç–∞–≤–∞: –ù–µ (0 –¥–µ–Ω)</option>
        </select>
        <input class="inp" id="deliveryAddress" placeholder="–ê–¥—Ä–µ—Å–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∞ (–∞–∫–æ –µ –î–∞)" />
      </div>

      <textarea class="ta" id="custNote" placeholder="–ù–∞–ø–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)"></textarea>
      <div class="small">–ê–∫–æ –µ –±–µ–∑ –¥–æ—Å—Ç–∞–≤–∞, –ø–æ–¥–∏–≥–∞—ö–µ: <b>–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞</b>. –å–µ —Å–µ –æ—Ç–≤–æ—Ä–∏ WhatsApp —Å–æ –≥–æ—Ç–æ–≤–∞ –ø–æ—Ä–∞–∫–∞.</div>
      <button class="btn btn-dark" id="sendWhatsappBtn">–ò—Å–ø—Ä–∞—Ç–∏ –Ω–∞ WhatsApp</button>
    </div>
  </div>
</div>

<!-- Admin modal -->
<div class="modal" id="adminModal">
  <div class="modalHead">
    <h3>Admin –ø–∞–Ω–µ–ª</h3>
    <button class="xbtn" id="closeAdminBtn">‚úï</button>
  </div>
  <div class="modalBody">
    <div id="adminLoginBox">
      <div class="small">–í–Ω–µ—Å–∏ PIN –∑–∞ Admin (default: 1234)</div>
      <div class="two" style="margin-top:10px;">
        <input class="inp" id="adminPinInp" placeholder="PIN" type="password" />
        <button class="btn btn-dark" id="adminLoginBtn">–í–ª–µ–∑–∏</button>
      </div>
    </div>

    <div id="adminPanelBox" style="display:none;">
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn-ghost" id="clearOverridesBtn">Reset demo overrides</button>
        <button class="btn btn-ghost" id="clearCustomBtn">–ò–∑–±—Ä–∏—à–∏ –°–ò–¢–ï custom</button>
        <button class="btn btn-ghost" id="changePinBtn">–ü—Ä–æ–º–µ–Ω–∏ PIN</button>
      </div>

      <div class="hr"></div>

      <div class="small"><b>–î–æ–¥–∞—ò / –ò–∑–º–µ–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–¥</b></div>
      <div class="row" style="margin-top:10px;">
        <div class="two">
          <input class="inp" id="pId" placeholder="ID (–æ—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ –∑–∞ –Ω–æ–≤)" />
          <input class="inp" id="pName" placeholder="–ò–º–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥" />
        </div>

        <div class="two">
          <select class="sel" id="pCat"></select>
          <input class="inp" id="pPrice" placeholder="–¶–µ–Ω–∞ (–¥–µ–Ω)" inputmode="numeric" />
        </div>

        <div class="two">
          <input class="inp" id="pOldPrice" placeholder="–°—Ç–∞—Ä–∞ —Ü–µ–Ω–∞ (–æ–ø—Ü.)" inputmode="numeric" />
          <select class="sel" id="pBadge">
            <option value="">–ë–µ–∑ –æ–∑–Ω–∞–∫–∞</option>
            <option value="–ù–û–í–û">–ù–û–í–û</option>
            <option value="–ê–ö–¶–ò–à–ê">–ê–ö–¶–ò–à–ê</option>
          </select>
        </div>

        <!-- NEW: Brand + Color -->
        <div class="two">
          <input class="inp" id="pBrand" placeholder="–ë—Ä–µ–Ω–¥/–ú–∞—Ä–∫–∞ (–ø—Ä–∏–º–µ—Ä: Zara)" />
          <input class="inp" id="pColor" placeholder="–ë–æ—ò–∞ (–ø—Ä–∏–º–µ—Ä: black)" />
        </div>

        <div class="two">
          <input class="inp" id="pImg" placeholder="–°–ª–∏–∫–∞ URL (–æ–ø—Ü.) –∏–ª–∏ —ú–µ —Å–µ –ø–æ–ø–æ–ª–Ω–∏ –æ–¥ Upload" />
          <input class="inp" id="pSizes" placeholder="–ì–æ–ª–µ–º–∏–Ω–∏ (–∑–∞–ø–∏—Ä–∫–∞) –ø—Ä–∏–º–µ—Ä: S,M,L –∏–ª–∏ 30,31..42" />
        </div>

        <div class="two">
          <input class="inp" id="pImgFile" type="file" accept="image/*" />
          <input class="inp" id="pImgCam" type="file" accept="image/*" capture="environment" />
        </div>
        <div class="small">2) <b>–ö–∞—á–∏ —Å–ª–∏–∫–∞ –æ–¥ –∫–∞–º–µ—Ä–∞</b> (–≤—Ç–æ—Ä–∏–æ—Ç upload)</div>

        <img id="imgPreview" style="width:100%; max-width:240px; margin-top:8px; border-radius:14px; display:none; border:1px solid var(--border);" />

        <div class="two">
          <button class="btn btn-dark" id="saveProductBtn">–°–Ω–∏–º–∏</button>
          <button class="btn btn-red" id="deleteProductBtn">–ò–∑–±—Ä–∏—à–∏ (ID)</button>
        </div>
        <div class="small" id="adminMsg"></div>
      </div>

      <div class="hr"></div>

      <div class="two">
        <select class="sel" id="adminFilterCat"></select>
        <input class="inp" id="adminSearch" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò (custom + demo)..." />
      </div>

      <div class="small" style="margin-top:10px;"><b>–õ–∏—Å—Ç–∞ (–ø—Ä–≤–∏ 200)</b></div>
      <div id="adminList"></div>

      <div class="hr"></div>

      <div class="small"><b>Export / Import</b></div>
      <div class="two" style="margin-top:10px;">
        <button class="btn btn-ghost" id="exportBtn">–ö–æ–ø–∏—Ä–∞—ò JSON</button>
        <button class="btn btn-ghost" id="importBtn">Import JSON</button>
      </div>
      <textarea class="ta" id="jsonBox" placeholder="Export —ú–µ —Å–µ –ø–æ—ò–∞–≤–∏ —Ç—É–∫–∞ / –∏–ª–∏ –∑–∞–ª–µ–ø–∏ JSON –∑–∞ Import..."></textarea>
    </div>
  </div>
</div>

<script>
  // ===== SETTINGS =====
  const WHATSAPP_NUMBER = "38972912601";
  const STORE_LOCATION = "–¢–¶ –ú–∞–≤—Ä–æ–≤–∫–∞";
  const SHIPPING_FEE = 150;

  const PAGE_SIZE = 30;
  const MAX_PER_CATEGORY = 150;

  const DEFAULT_SIZES = ["S","M","L","XL","2XL","3XL"];
  const JEANS_SIZES = Array.from({length: 13}, (_,i)=> String(30+i)); // 30..42

  const BRANDS = ["MertaX","Zara","Nike","Adidas","H&M","Pull&Bear","Bershka"];
  const COLORS = ["black","white","blue","green","beige","gray","red"];

  const CATEGORIES = [
    "–è–µ–º–ø–µ—Ä–∏","–ë–ª—É–∑–æ–Ω–∏","–ú–∞–∏—Ü–∏","–ö–æ—à—É–ª–∏",
    "–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏","–¢—Ä–µ–Ω–µ—Ä–∫–∏","–à–∞–∫–Ω–∏","–û–¥–µ–ª–∞"
  ];

  // Storage keys
  const CART_KEY = "mertax_cart_v300";
  const ADMIN_PIN_KEY = "mertax_admin_pin_v1";
  const CUSTOM_KEY = "mertax_custom_products_v2";
  const DELETED_KEY = "mertax_deleted_ids_v1";

  const round10 = (n)=> Math.round(n/10)*10;

  function catKey(cat){
    return cat.toLowerCase()
      .replaceAll(" ","-").replaceAll("/","-")
      .replaceAll("—ú","k").replaceAll("—ü","dz").replaceAll("–∂","zh")
      .replaceAll("—á","ch").replaceAll("—à","sh")
      .replaceAll("—ô","lj").replaceAll("—ö","nj")
      .replaceAll("—ì","gj").replaceAll("—ï","dz")
      .replaceAll("–∞","a").replaceAll("–±","b").replaceAll("–≤","v").replaceAll("–≥","g")
      .replaceAll("–¥","d").replaceAll("–µ","e").replaceAll("–∑","z").replaceAll("–∏","i")
      .replaceAll("—ò","j").replaceAll("–∫","k").replaceAll("–ª","l").replaceAll("–º","m")
      .replaceAll("–Ω","n").replaceAll("–æ","o").replaceAll("–ø","p").replaceAll("—Ä","r")
      .replaceAll("—Å","s").replaceAll("—Ç","t").replaceAll("—É","u").replaceAll("—Ñ","f")
      .replaceAll("—Ö","h").replaceAll("—Ü","c");
  }

  function demoImg(seed){
    return `https://picsum.photos/seed/${encodeURIComponent(seed)}/900/900`;
  }

  function priceByCategory(cat){
    switch(cat){
      case "–ú–∞–∏—Ü–∏": return 990;
      case "–ö–æ—à—É–ª–∏": return 1490;
      case "–è–µ–º–ø–µ—Ä–∏": return 1890;
      case "–ë–ª—É–∑–æ–Ω–∏": return 2190;
      case "–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏": return 1990;
      case "–¢—Ä–µ–Ω–µ—Ä–∫–∏": return 2290;
      case "–à–∞–∫–Ω–∏": return 3990;
      case "–û–¥–µ–ª–∞": return 7990;
      default: return 1490;
    }
  }
  function sizesByCategory(cat){
    return (cat === "–§–∞—Ä–º–µ—Ä–∫–∏/–ü–∞–Ω—Ç–∞–ª–æ–Ω–∏") ? JEANS_SIZES.slice() : DEFAULT_SIZES.slice();
  }

  function makeId(){
    const rnd = Math.random().toString(16).slice(2,8).toUpperCase();
    const t = Date.now().toString(16).slice(-6).toUpperCase();
    return `mx_${t}_${rnd}`;
  }

  // ===== DEMO PRODUCT =====
  function demoProduct(cat, idx1){
    const basePrice = priceByCategory(cat);
    const price = round10(basePrice + (idx1 % 7) * 40);
    const isSale = (idx1 % 4 === 0);
    const isNew  = (!isSale && idx1 % 7 === 0);
    const oldPrice = isSale ? round10(price + 300 + (idx1 % 5) * 50) : null;
    const badge = isSale ? "–ê–ö–¶–ò–à–ê" : (isNew ? "–ù–û–í–û" : "");
    const id = `auto_${catKey(cat)}_${idx1}`;

    const brand = BRANDS[idx1 % BRANDS.length];
    const color = COLORS[idx1 % COLORS.length];

    return {
      id, name: `MertaX ${cat} #${idx1}`, cat,
      price, oldPrice, badge,
      brand, color,
      sizes: sizesByCategory(cat),
      img: demoImg(`${catKey(cat)}-${idx1}`)
    };
  }

  // ===== STORAGE =====
  function loadCustom(){
    try{ const arr = JSON.parse(localStorage.getItem(CUSTOM_KEY) || "[]"); return Array.isArray(arr)?arr:[]; }
    catch(e){ return []; }
  }
  function saveCustom(arr){ localStorage.setItem(CUSTOM_KEY, JSON.stringify(arr)); }

  function loadDeleted(){
    try{ const arr = JSON.parse(localStorage.getItem(DELETED_KEY) || "[]"); return Array.isArray(arr)?arr:[]; }
    catch(e){ return []; }
  }
  function saveDeleted(arr){ localStorage.setItem(DELETED_KEY, JSON.stringify(arr)); }

  function customMap(){
    const map = new Map();
    for(const p of loadCustom()) map.set(p.id, p);
    return map;
  }

  function getCategoryList(cat){
    const del = new Set(loadDeleted());
    const cMap = customMap();
    const list = [];

    for(let i=1;i<=MAX_PER_CATEGORY;i++){
      const dp = demoProduct(cat, i);
      if(del.has(dp.id)) continue;
      const ov = cMap.get(dp.id);
      list.push(ov ? ov : dp);
    }

    for(const p of cMap.values()){
      if(p.cat !== cat) continue;
      if((p.id || "").startsWith("auto_")) continue;
      if(del.has(p.id)) continue;
      list.unshift(p);
    }

    return list;
  }

  // ===== CART =====
  const loadCart = () => JSON.parse(localStorage.getItem(CART_KEY) || "[]");
  const saveCart = (cart) => localStorage.setItem(CART_KEY, JSON.stringify(cart));

  function findProductById(id){
    const cMap = customMap();
    if(cMap.has(id)) return cMap.get(id);

    if(id.startsWith("auto_")){
      for(const cat of CATEGORIES){
        const prefix = `auto_${catKey(cat)}_`;
        if(id.startsWith(prefix)){
          const idx = Number(id.slice(prefix.length));
          if(Number.isFinite(idx) && idx>=1 && idx<=MAX_PER_CATEGORY){
            return demoProduct(cat, idx);
          }
        }
      }
    }
    return null;
  }

  // ===== UI REFS =====
  const grid = document.getElementById("productGrid");
  const tabs = document.getElementById("tabs");
  const infoLine = document.getElementById("infoLine");
  const searchInp = document.getElementById("searchInp");
  const sortSel = document.getElementById("sortSel");
  const loadMoreBtn = document.getElementById("loadMoreBtn");

  // filter drawer inputs
  const sizeFilterSel = document.getElementById("sizeFilterSel");
  const brandFilterInp = document.getElementById("brandFilterInp");
  const colorFilterInp = document.getElementById("colorFilterInp");
  const minPriceInp = document.getElementById("minPriceInp");
  const maxPriceInp = document.getElementById("maxPriceInp");
  const badgeFilterSel = document.getElementById("badgeFilterSel");

  const overlay = document.getElementById("overlay");
  const drawer = document.getElementById("drawer");
  const cartList = document.getElementById("cartList");
  const cartCount = document.getElementById("cartCount");
  const cartTotal = document.getElementById("cartTotal");
  const sumItems = document.getElementById("sumItems");
  const sumTotal = document.getElementById("sumTotal");
  const shipLine = document.getElementById("shipLine");

  const filterDrawer = document.getElementById("filterDrawer");

  const deliverySel = document.getElementById("deliverySel");

  let activeCat = CATEGORIES[0];
  let visibleCount = PAGE_SIZE;

  // Filter state (Zara-like drawer -> apply)
  const filterState = {
    size: "ALL",
    brand: "",
    color: "",
    minPrice: "",
    maxPrice: "",
    badge: "ALL"
  };

  function renderTabs(){
    tabs.innerHTML = CATEGORIES.map(c =>
      `<button class="tab ${c===activeCat?"active":""}" data-cat="${c}">${c}</button>`
    ).join("");
    tabs.querySelectorAll(".tab").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        activeCat = btn.getAttribute("data-cat");
        visibleCount = PAGE_SIZE;
        renderTabs();
        renderSizeFilter();
        renderProducts();
      });
    });
  }

  function renderSizeFilter(){
    const sizes = sizesByCategory(activeCat);
    sizeFilterSel.innerHTML =
      [`<option value="ALL">–°–∏—Ç–µ</option>`]
      .concat(sizes.map(s=>`<option value="${s}">${s}</option>`))
      .join("");
    sizeFilterSel.value = filterState.size || "ALL";
  }

  function numOrNull(v){
    const t = String(v || "").trim();
    if(!t) return null;
    const n = Number(t);
    return Number.isFinite(n) ? n : null;
  }

  function filteredAll(){
    let list = getCategoryList(activeCat);

    // search (name + brand + color)
    const q = (searchInp.value || "").trim().toLowerCase();
    if(q){
      list = list.filter(p => {
        const a = (p.name||"").toLowerCase();
        const b = (p.brand||"").toLowerCase();
        const c = (p.color||"").toLowerCase();
        return a.includes(q) || b.includes(q) || c.includes(q);
      });
    }

    // drawer filters (applied from state)
    const size = filterState.size || "ALL";
    const brand = (filterState.brand || "").trim().toLowerCase();
    const color = (filterState.color || "").trim().toLowerCase();
    const minP = numOrNull(filterState.minPrice);
    const maxP = numOrNull(filterState.maxPrice);
    const badge = filterState.badge || "ALL";

    if(size !== "ALL"){
      list = list.filter(p => Array.isArray(p.sizes) && p.sizes.includes(size));
    }
    if(brand){
      list = list.filter(p => (p.brand||"").toLowerCase().includes(brand));
    }
    if(color){
      list = list.filter(p => (p.color||"").toLowerCase().includes(color));
    }
    if(minP !== null) list = list.filter(p => Number(p.price) >= minP);
    if(maxP !== null) list = list.filter(p => Number(p.price) <= maxP);

    if(badge === "NONE") list = list.filter(p => !(p.badge||"").trim());
    else if(badge !== "ALL") list = list.filter(p => (p.badge||"").trim() === badge);

    // sorting
    const mode = sortSel.value || "default";
    const scoreBadge = (p, wanted
